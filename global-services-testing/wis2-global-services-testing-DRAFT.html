<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<meta name="copyright" content="Copyright © 2024 World Meteorological Organization (WMO)">
<title>WIS2 Global Services testing</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child{border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active,#footnotes .footnote a:first-of-type:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="book">
<div id="header">
<h1>WIS2 Global Services testing</h1>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div style="page-break-after: always;"></div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #FFFFFF;"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #FFFFFF;"><p class="tableblock"><strong class="big">World Meteorological Organization</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #FFFFFF;"><p class="tableblock">Date: 2024-08-13</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #FFFFFF;"><p class="tableblock">Version: 2024-03-28</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #FFFFFF;"><p class="tableblock">Document location: <a href="https://community.wmo.int/wis2-global-services-testing" class="bare">https://community.wmo.int/wis2-global-services-testing</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #FFFFFF;"><p class="tableblock">Standing Committee on Information Management and Technology (SC-IMT)<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #FFFFFF;"><p class="tableblock">Commission for Observation, Infrastructure and Information Systems (INFCOM)<sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #FFFFFF;"><p class="tableblock">Copyright © 2024 World Meteorological Organization (WMO)</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
<div id="toc" class="toc">
<div id="toctitle" class="title">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_abstract">1. Abstract</a></li>
<li><a href="#_executive_summary">2. Executive Summary</a></li>
<li><a href="#_scope">3. Scope</a></li>
<li><a href="#_terms_and_definitions">4. Terms and definitions</a>
<ul class="sectlevel2">
<li><a href="#_abbreviated_terms">4.1. Abbreviated terms</a></li>
</ul>
</li>
<li><a href="#_references">5. References</a></li>
<li><a href="#testing">6. High Level Architecture</a>
<ul class="sectlevel2">
<li><a href="#_wis2_specifications">6.1. WIS2 Specifications</a>
<ul class="sectlevel3">
<li><a href="#_wis2_topic_hierarchy_wth">6.1.1. WIS2 Topic Hierarchy (WTH)</a></li>
<li><a href="#_wis2_notification_message_wnm">6.1.2. WIS2 Notification Message (WNM)</a></li>
<li><a href="#_wmo_core_metadata_profile_wcmp2">6.1.3. WMO Core Metadata Profile (WCMP2)</a></li>
</ul>
</li>
<li><a href="#_wis2_components">6.2. WIS2 Components</a>
<ul class="sectlevel3">
<li><a href="#_global_broker">6.2.1. Global Broker</a></li>
<li><a href="#_global_cache">6.2.2. Global Cache</a></li>
<li><a href="#_global_discovery_catalogue">6.2.3. Global Discovery Catalogue</a></li>
<li><a href="#_global_monitor">6.2.4. Global Monitor</a></li>
</ul>
</li>
<li><a href="#_testing_framework">6.3. Testing framework</a>
<ul class="sectlevel3">
<li><a href="#_data">6.3.1. Data</a></li>
<li><a href="#_environment">6.3.2. Environment</a></li>
<li><a href="#_performance_testing">6.3.3. Performance testing</a></li>
<li><a href="#_functional_testing">6.3.4. Functional testing</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_tests">7. Tests</a>
<ul class="sectlevel2">
<li><a href="#global-broker-testing">7.1. Global Broker Service testing</a>
<ul class="sectlevel3">
<li><a href="#_functional_tests">7.1.1. Functional tests</a></li>
</ul>
</li>
<li><a href="#global-cache-testing">7.2. Global Cache Service testing</a>
<ul class="sectlevel3">
<li><a href="#_functional_tests_2">7.2.1. Functional Tests</a></li>
<li><a href="#_performance_tests">7.2.2. Performance tests</a></li>
<li><a href="#_implicit_tests">7.2.3. Implicit tests</a></li>
</ul>
</li>
<li><a href="#global-discovery-catalogue-testing">7.3. Global Discovery Catalogue Service testing</a>
<ul class="sectlevel3">
<li><a href="#_test_setup">7.3.1. Test setup</a></li>
<li><a href="#_functional_tests_3">7.3.2. Functional tests</a></li>
<li><a href="#_performance_tests_2">7.3.3. Performance tests</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#results">8. Results</a>
<ul class="sectlevel2">
<li><a href="#global-cache-results">8.1. Global Cache Service results</a>
<ul class="sectlevel3">
<li><a href="#global-cache-china-results">8.1.1. China</a></li>
<li><a href="#global-cache-germany-results">8.1.2. Germany</a></li>
<li><a href="#global-cache-japan-results">8.1.3. Japan</a></li>
<li><a href="#global-cache-korea-results">8.1.4. Republic of Korea</a></li>
<li><a href="#global-cache-uk-us-results">8.1.5. United Kingdom of Great Britain and Northern Ireland / United States of America</a></li>
</ul>
</li>
<li><a href="#global-broker-results">8.2. Global Broker Service results</a>
<ul class="sectlevel3">
<li><a href="#global-broker-brazil-results">8.2.1. Brazil</a></li>
<li><a href="#global-broker-china-results">8.2.2. China</a></li>
<li><a href="#global-broker-france-results">8.2.3. France</a></li>
<li><a href="#global-broker-usa-results">8.2.4. United States of America</a></li>
</ul>
</li>
<li><a href="#global-discovery-catalogue-results">8.3. Global Discovery Catalogue results</a>
<ul class="sectlevel3">
<li><a href="#global-discovery-catalogue-canada-results">8.3.1. Canada</a></li>
<li><a href="#global-discovery-catalogue-china-results">8.3.2. China</a></li>
</ul>
</li>
<li><a href="#global-monitor-results">8.4. Global Monitor results</a>
<ul class="sectlevel3">
<li><a href="#global-monitor-china-results">8.4.1. China</a></li>
<li><a href="#global-monitor-morocco-results">8.4.2. Morocco</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#discussion">9. Discussion</a></li>
<li><a href="#conclusions">10. Conclusions</a></li>
<li><a href="#_future_work">11. Future work</a></li>
<li><a href="#_revision_history">Appendix A: Revision History</a></li>
<li><a href="#annex-bibliography">Bibliography</a></li>
</ul>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1 preface">
<h2 id="_abstract"><a class="anchor" href="#_abstract"></a>1. Abstract</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The subject of this Report is the results of testing and experimentation of WIS2 Global Services during the pre-operational phase of WIS2.  Global Services testing is coordinated by the WIS2 Architecture and Transition team and provides results and recommendations on testing performance, availability and functionality.</p>
</div>
</div>
</div>
<div class="sect1 preface">
<h2 id="_executive_summary"><a class="anchor" href="#_executive_summary"></a>2. Executive Summary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>TODO</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_scope"><a class="anchor" href="#_scope"></a>3. Scope</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This report presents the testing framework put forth as part of the pre-operational phase of Global Services testing.  This report also discussses the results and presents a set of conclusions and recommendations.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_terms_and_definitions"><a class="anchor" href="#_terms_and_definitions"></a>4. Terms and definitions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This document uses the terms defined in <a href="https://portal.ogc.org/public_ogc/directives/directives.php">OGC Policy Directive 49</a>, which is based on the ISO/IEC Directives, Part 2, Rules for the structure and drafting of International Standards. In particular, the word “shall” (not “must”) is the verb form used to indicate a requirement to be strictly followed to conform to this Standard and OGC documents do not use the equivalent phrases in the ISO/IEC Directives, Part 2.</p>
</div>
<div class="paragraph">
<p>This document also uses terms defined in the OGC Standard for Modular specifications (<a href="https://portal.opengeospatial.org/files/?artifact_id=34762">OGC 08-131r3</a>), also known as the 'ModSpec'. The definitions of terms such as standard, specification, requirement, and conformance test are provided in the ModSpec.</p>
</div>
<div class="sect2">
<h3 id="_abbreviated_terms"><a class="anchor" href="#_abbreviated_terms"></a>4.1. Abbreviated terms</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">API</dt>
<dd>
<p>Application Programming Interface</p>
</dd>
<dt class="hdlist1">GB</dt>
<dd>
<p>Global Broker</p>
</dd>
<dt class="hdlist1">GC</dt>
<dd>
<p>Global Cache</p>
</dd>
<dt class="hdlist1">GDC</dt>
<dd>
<p>Global Discovery Catalogue</p>
</dd>
<dt class="hdlist1">GISC</dt>
<dd>
<p>Global Information System Centre
GM: Global Monitor</p>
</dd>
<dt class="hdlist1">HTTP</dt>
<dd>
<p>Hypertext Transfer Protocol</p>
</dd>
<dt class="hdlist1">HTTPS</dt>
<dd>
<p>Hypertext Transfer Protocol Secure</p>
</dd>
<dt class="hdlist1">JSON</dt>
<dd>
<p>JavaScript Object Notation</p>
</dd>
<dt class="hdlist1">OGC</dt>
<dd>
<p>Open Geospatial Consortium</p>
</dd>
<dt class="hdlist1">MQTT</dt>
<dd>
<p>Message Queuing Telemetry Transport</p>
</dd>
<dt class="hdlist1">WCMP2</dt>
<dd>
<p>WMO Core Metadata Profile 2</p>
</dd>
<dt class="hdlist1">WIS</dt>
<dd>
<p>WMO Information System</p>
</dd>
<dt class="hdlist1">WMO</dt>
<dd>
<p>World Meteorological Organization</p>
</dd>
<dt class="hdlist1">WNM</dt>
<dd>
<p>WIS2 Notification Message</p>
</dd>
<dt class="hdlist1">WTH</dt>
<dd>
<p>WIS2 Topic Hierarchy</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_references"><a class="anchor" href="#_references"></a>5. References</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a id="wcmp2"></a> WMO: WMO Core Metadata Profile (2024) <sup class="footnote">[<a id="_footnoteref_3" class="footnote" href="#_footnotedef_3" title="View footnote.">3</a>]</sup></p>
</li>
<li>
<p><a id="wis2-notification-message"></a> WMO: WIS2 Notification Message (2024) <sup class="footnote">[<a id="_footnoteref_4" class="footnote" href="#_footnotedef_4" title="View footnote.">4</a>]</sup></p>
</li>
<li>
<p><a id="wis2-topic-hierarchy"></a> WMO: WIS2 Topic Hierarchy (2024) <sup class="footnote">[<a id="_footnoteref_5" class="footnote" href="#_footnotedef_5" title="View footnote.">5</a>]</sup></p>
</li>
<li>
<p><a id="wis2-guide"></a> Draft guidance on technical specifications of WIS2 (2024) <sup class="footnote">[<a id="_footnoteref_6" class="footnote" href="#_footnotedef_6" title="View footnote.">6</a>]</sup></p>
</li>
<li>
<p><a id="wis2-transition-guide"></a> Draft guidance on transition from GTS to WIS2 (2024) <sup class="footnote">[<a id="_footnoteref_7" class="footnote" href="#_footnotedef_7" title="View footnote.">7</a>]</sup></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="testing"><a class="anchor" href="#testing"></a>6. High Level Architecture</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The focus of testing is to evaluate functionality to ensure all WIS2 components perform as defined by the architecture.  Testing is designed to enable core workflows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>WIS2 Nodes providing data and metadata</p>
</li>
<li>
<p>WIS2 Global Brokers subscribing to WIS2 Nodes</p>
</li>
<li>
<p>WIS2 Global Caches providing data and metadata for core data and all metadata</p>
</li>
<li>
<p>WIS2 Global Discovery Catalogues providing a search API for published discovery metadata</p>
</li>
<li>
<p>WIS2 Global Monitors scraping metrics from WIS2 Global Services, and providing metrics/insights on WIS2 performance</p>
</li>
</ul>
</div>
<div id="img_architecture" class="imageblock text-center">
<div class="content">
<img src="https://raw.githubusercontent.com/wmo-im/wis2-guide/main/guide/images/architecture/c4.container.png" alt="c4.container" width="800">
</div>
<div class="title">Figure 1. High Level Overview of the WIS2 Architecture</div>
</div>
<div class="paragraph">
<p>The rest of this section describes the components deployed and standards implemented as part of WIS2.</p>
</div>
<div class="sect2">
<h3 id="_wis2_specifications"><a class="anchor" href="#_wis2_specifications"></a>6.1. WIS2 Specifications</h3>
<div class="sect3">
<h4 id="_wis2_topic_hierarchy_wth"><a class="anchor" href="#_wis2_topic_hierarchy_wth"></a>6.1.1. WIS2 Topic Hierarchy (WTH)</h4>
<div class="paragraph">
<p>WTH defines the structure of the WIS Topic Hierarchy.  Topics are utilized by WIS Nodes, Global
Broker services, and data/metadata subscribers.</p>
</div>
</div>
<div class="sect3">
<h4 id="_wis2_notification_message_wnm"><a class="anchor" href="#_wis2_notification_message_wnm"></a>6.1.2. WIS2 Notification Message (WNM)</h4>
<div class="paragraph">
<p>WNM defines the content, structure, and encoding for the WIS2 Notification Message
Encoding.  WNMs are provided as MQP payloads by WIS2 nodes, Global Broker services, as well
as Replay API services (optional OGC API - Features services for data notifications).</p>
</div>
</div>
<div class="sect3">
<h4 id="_wmo_core_metadata_profile_wcmp2"><a class="anchor" href="#_wmo_core_metadata_profile_wcmp2"></a>6.1.3. WMO Core Metadata Profile (WCMP2)</h4>
<div class="paragraph">
<p>WCMP2 defines the content, structure, and encoding for WMO resources.  WMO resources include, but are not
limited to, data (NWP models, observations, forecasts and warnings, etc.), services/APIs, and processes.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wis2_components"><a class="anchor" href="#_wis2_components"></a>6.2. WIS2 Components</h3>
<div class="sect3">
<h4 id="_global_broker"><a class="anchor" href="#_global_broker"></a>6.2.1. Global Broker</h4>
<div class="paragraph">
<p>WIS2 incorporates several Global Brokers, ensuring highly resilient distribution of notification messages across the globe.</p>
</div>
</div>
<div class="sect3">
<h4 id="_global_cache"><a class="anchor" href="#_global_cache"></a>6.2.2. Global Cache</h4>
<div class="paragraph">
<p>A Global Cache provides a highly available data server from which a Data Consumer can download Core data, as specified in the WMO Unified Data Policy, Resolution 1 (Cg-Ext(2021)).</p>
</div>
</div>
<div class="sect3">
<h4 id="_global_discovery_catalogue"><a class="anchor" href="#_global_discovery_catalogue"></a>6.2.3. Global Discovery Catalogue</h4>
<div class="paragraph">
<p>A Global Discovery Catalogue enables a data consumer to search and browse descriptions of data published by each WIS2 Node. The data description (i.e., discovery metadata) provides sufficient information to determine the usefulness of data and how one may access it.</p>
</div>
</div>
<div class="sect3">
<h4 id="_global_monitor"><a class="anchor" href="#_global_monitor"></a>6.2.4. Global Monitor</h4>
<div class="paragraph">
<p>A Global Monitor tracks what data is published by WIS2 Nodes, whether data can be effectively accessed by Data Consumers, and the performance of components in the WIS2 system.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_testing_framework"><a class="anchor" href="#_testing_framework"></a>6.3. Testing framework</h3>
<div class="sect3">
<h4 id="_data"><a class="anchor" href="#_data"></a>6.3.1. Data</h4>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
<div class="sect3">
<h4 id="_environment"><a class="anchor" href="#_environment"></a>6.3.2. Environment</h4>
<div class="paragraph">
<p>The WIS2 development environment will be used as the target network for executing tests.</p>
</div>
</div>
<div class="sect3">
<h4 id="_performance_testing"><a class="anchor" href="#_performance_testing"></a>6.3.3. Performance testing</h4>
<div class="paragraph">
<p>Ensure WIS2 Global Services are able to operate under various loads.</p>
</div>
</div>
<div class="sect3">
<h4 id="_functional_testing"><a class="anchor" href="#_functional_testing"></a>6.3.4. Functional testing</h4>
<div class="paragraph">
<p>Ensure WIS2 Global Services operate with one another as expected and meet requirements.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tests"><a class="anchor" href="#_tests"></a>7. Tests</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="global-broker-testing"><a class="anchor" href="#global-broker-testing"></a>7.1. Global Broker Service testing</h3>
<div class="paragraph">
<p>All Global Services, and in particular Global Brokers and Global Caches, are collectively responsible in making the WIS a reliable and efficient mean to exchange
data required for the operations of all WIS Centres. The agreed architecture provides a redundant solution where the failure of one component will not impact the overall level of service of WIS.  Each Global Service should aim at achieving at least 99.5% availability of the service they propose. This is not a contractual target. It should be considered by the entity providing the Global Service as a guideline when designing and operating the Global Service.</p>
</div>
<div class="paragraph">
<p>A Global Broker:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>should support a minimum of <strong>200</strong> WIS2 Nodes or Global Services</p>
</li>
<li>
<p>should support a minimum of <strong>1000</strong> subscribers.</p>
</li>
<li>
<p>should support processing of a minimum of <strong>10000</strong> messages per second</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_functional_tests"><a class="anchor" href="#_functional_tests"></a>7.1.1. Functional tests</h4>
<div class="sect4">
<h5 id="_1_global_broker_connectivity_tests"><a class="anchor" href="#_1_global_broker_connectivity_tests"></a>7.1.1.1. 1. Global Broker Connectivity Tests</h5>
<div class="paragraph">
<p>There are several test that can be performed on the Global Broker in advance of the planned GB testing period (currently scheduled for September 30 - October 4).
A. to D. below can be performed any time.</p>
</div>
<div class="sect5">
<h6 id="_a_global_broker_port_tests"><a class="anchor" href="#_a_global_broker_port_tests"></a>A. Global Broker Port Tests</h6>

</div>
<div class="sect5">
<h6 id="_purpose"><a class="anchor" href="#_purpose"></a>Purpose</h6>
<div class="paragraph">
<p>An MQTT client must be able to connect to the local broker of the Global Broker on ports 8883 (MQTTS) or 443 (WSS) using the agreed protocols with Transport Layer Security (TLS) and username/password authentication.</p>
</div>
</div>
<div class="sect5">
<h6 id="_requirements"><a class="anchor" href="#_requirements"></a>Requirements</h6>
<div class="ulist">
<ul>
<li>
<p>Global Broker MQTT details.</p>
</li>
<li>
<p>MQTT Test Client</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_steps"><a class="anchor" href="#_steps"></a>Steps</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Initialise the test MQTT client with the necessary parameters such as the MQTT protocol, TLS security, and username/password for authentication (connection string).</p>
</li>
<li>
<p>Attempt to connect the MQTT broker of the Global Broker using the connection string.</p>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="_evaluate"><a class="anchor" href="#_evaluate"></a>Evaluate</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Check if the connection is successful.</p>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="_b_global_broker_certificate_test"><a class="anchor" href="#_b_global_broker_certificate_test"></a>B. Global Broker Certificate Test</h6>

</div>
<div class="sect5">
<h6 id="_purpose_2"><a class="anchor" href="#_purpose_2"></a>Purpose</h6>
<div class="paragraph">
<p>The Global Broker service must use a valid certificate.  Transport Layer Security (TLS) is an encryption protocol that provides secure connections between servers and applications on the internet.</p>
</div>
</div>
<div class="sect5">
<h6 id="_requirements_2"><a class="anchor" href="#_requirements_2"></a>Requirements</h6>
<div class="ulist">
<ul>
<li>
<p>Global Broker MQTT connection string</p>
</li>
<li>
<p>MQTT Test Client (If used, MQTT Explorer needs to import the Certificate Authority used by the Global Broker to check that the certificate is valid) or a browser like Firefox.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_steps_2"><a class="anchor" href="#_steps_2"></a>Steps</h6>
<div class="paragraph">
<p>From the client and try to connect to a Global Broker using WSS protocol.  The Global Broker sends the MQTT client its TLS certificate.  The MQTT client then verifies that the certificate is valid and digitally signed by a trusted CA by comparing it with information it stores about trusted CAs. The signed certificate verifies the website server’s public key, which confirms that you’re communicating with the genuine server of the website you’re visiting.  The server also authenticates a key exchange, resulting in a one-time session key that is used to send encrypted and authenticated data between the clients and the server.
If a browser like Firefox is used, connect WSS endpoint (<a href="https://globalbroker.example.org/mqtt" class="bare">https://globalbroker.example.org/mqtt</a>). In the address bar, a lock is displayed.</p>
</div>
</div>
<div class="sect5">
<h6 id="_evaluate_2"><a class="anchor" href="#_evaluate_2"></a>Evaluate</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Check if the TLS connection is successful</p>
</li>
<li>
<p>Check for certification verification.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If the connection is successful and the certificate are valid, the test passes. If the connection is not successful or the certificate is invalid, the test fails.</p>
</div>
</div>
<div class="sect5">
<h6 id="_c_global_broker_origin_and_cache_read_access_test"><a class="anchor" href="#_c_global_broker_origin_and_cache_read_access_test"></a>C. Global Broker Origin and Cache Read-Access Test</h6>

</div>
<div class="sect5">
<h6 id="_purpose_3"><a class="anchor" href="#_purpose_3"></a>Purpose</h6>
<div class="paragraph">
<p>The Global Broker service must allow <span class="underline">only</span> read access to <em>origin/a/wis2/<mark></em> and <em>cache/a/wis2/</mark></em> using a username and password credential of everyone/everyone</p>
</div>
</div>
<div class="sect5">
<h6 id="_requirements_3"><a class="anchor" href="#_requirements_3"></a>Requirements</h6>
<div class="ulist">
<ul>
<li>
<p>Global Broker MQTT connection string</p>
</li>
<li>
<p>MQTT Test Client</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_steps_3"><a class="anchor" href="#_steps_3"></a>Steps</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>From a MQTT client, set up a new connection to the Global Broker, with the following configuration settings:</p>
</li>
<li>
<p>Configure 2 subscriptions.  First, create separate subscriptions for <em>origin/a/wis2/<mark></em> and <em>cache/a/wis2/</mark></em> using a username and password credential for "everyone/everyone"</p>
</li>
<li>
<p>Save the configuration and click connect</p>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="_evaluate_3"><a class="anchor" href="#_evaluate_3"></a>Evaluate</h6>
<div class="paragraph">
<p>Check if the connection is successful, and depending on the flow of messages, messages should appear rapidly.  If messages are displayed, the test passes. If the connection is not successful, the test fails.</p>
</div>
</div>
<div class="sect5">
<h6 id="_d_global_broker_deny_write_access_to_originawis2_and_cacheawis2_for_everyoneeveryone_credentials_test"><a class="anchor" href="#_d_global_broker_deny_write_access_to_originawis2_and_cacheawis2_for_everyoneeveryone_credentials_test"></a>D. Global Broker deny write access to <em>origin/a/wis2/<mark></em> and <em>cache/a/wis2/</mark></em> for everyone/everyone credentials Test</h6>

</div>
<div class="sect5">
<h6 id="_purpose_4"><a class="anchor" href="#_purpose_4"></a>Purpose</h6>
<div class="paragraph">
<p>The Global Broker service must prevent write access to any topic with everyone/everyone credentials</p>
</div>
</div>
<div class="sect5">
<h6 id="_requirements_4"><a class="anchor" href="#_requirements_4"></a>Requirements</h6>
<div class="ulist">
<ul>
<li>
<p>Global Broker MQTT connection string</p>
</li>
<li>
<p>MQTT Test Client</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_steps_4"><a class="anchor" href="#_steps_4"></a>Steps</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use an MQTT client to connect to Global Broker</p>
</li>
<li>
<p>Try to publish data or metadata to Global Broker</p>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="_evaluate_4"><a class="anchor" href="#_evaluate_4"></a>Evaluate</h6>
<div class="paragraph">
<p>Check if the connection is successful, and the publication fails or the connection drops, the test is successful. If the connection is successful, and the publication is allowed, the test fails.</p>
</div>
</div>
<div class="sect5">
<h6 id="_e_global_broker_cluster_redundancy_test"><a class="anchor" href="#_e_global_broker_cluster_redundancy_test"></a>E. Global Broker cluster redundancy Test</h6>

</div>
<div class="sect5">
<h6 id="_purpose_5"><a class="anchor" href="#_purpose_5"></a>Purpose</h6>
<div class="paragraph">
<p>The Global Broker service, should be using a MQTT server deployed in a cluster, then the MQTT Broker must use a redundant load balancing service so that the service in maintained in case of failure of one entity of the cluster</p>
</div>
</div>
<div class="sect5">
<h6 id="_requirements_5"><a class="anchor" href="#_requirements_5"></a>Requirements</h6>
<div class="ulist">
<ul>
<li>
<p>Global Broker MQTT connection string</p>
</li>
<li>
<p>MQTT Test Client</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_steps_5"><a class="anchor" href="#_steps_5"></a>Steps</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>From a MQTT client, set up a new subscription to either "origin/a/wis2/" and "cache/a/wis2/" using a username and password credential for "everyone/everyone".</p>
</li>
<li>
<p>Fail a member of the cluster and ensure that subscriptions are still being fulfilled</p>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="_evaluate_5"><a class="anchor" href="#_evaluate_5"></a>Evaluate</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Check if the subscription is successful even after the members of the cluster are failed. If the subscription continues as cluster is altered, the test passes. If the subscription is not fulfilled after cluster alternation, the test fails.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_2_global_broker_antiloop_testing"><a class="anchor" href="#_2_global_broker_antiloop_testing"></a>7.1.1.2. 2. Global Broker Antiloop Testing</h5>
<div class="paragraph">
<p>The antiloop feature of a Global Broker is a critical aspect of WIS2 Architecture. This is what guarantees a high level of service while preventing “messages storm”.  These tests are designed to test the antiloop feature of the Global Broker service.  This must be fully functional for each WIS2 Global Broker properly prior WIS2 going to an operational state on January 1st, 2025.
If configurable, and when applicable, the Global Broker should discard incorrect WIS2 Notification Messages, by opposition of only verifying the correctness.</p>
</div>
<div class="sect5">
<h6 id="_a_discarding_of_duplicate_messages_test"><a class="anchor" href="#_a_discarding_of_duplicate_messages_test"></a>A. Discarding of duplicate messages Test</h6>

</div>
<div class="sect5">
<h6 id="_purpose_6"><a class="anchor" href="#_purpose_6"></a>Purpose</h6>
<div class="paragraph">
<p>The Global Broker service must discard all duplicated messages (identical id) received whatever the originator of the messages</p>
</div>
</div>
<div class="sect5">
<h6 id="_requirements_6"><a class="anchor" href="#_requirements_6"></a>Requirements</h6>
<div class="ulist">
<ul>
<li>
<p>The container <a href="https://hub.docker.com/r/golfvert/fakewis2node" class="bare">https://hub.docker.com/r/golfvert/fakewis2node</a> deployed on 5 tests system (<strong>io-wis2dev-10-test</strong> to <strong>io-wis2dev-14-test</strong>)</p>
</li>
<li>
<p>Global Broker MQTT connection string to 2 WIS2 Nodes (with the following centre_id: io-wis2dev-10-test and io-wis2dev-11-test)</p>
</li>
<li>
<p>MQTT Test Client subscribed to <strong>origin/a/wis2/io-wis2dev-10-test/#</strong> and <strong>origin/a/wis2/io-wis2dev-11-test/</strong></p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_steps_6"><a class="anchor" href="#_steps_6"></a>Steps</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>WIS2Node <em>io-wis2dev-10-test</em> publish on its local broker <strong>ten</strong> messages with a pre-defined id (using the UUID format) on topic <strong>origin/a/wis2/io-wis2dev-10-test/core/data/weather/surface-based-observation/synop</strong></p>
</li>
<li>
<p>WIS2Node <em>io-wis2dev-10-test</em> publish <strong>ten</strong> message with the same id (same id as above) on topic <strong>origin/a/io-wis2dev-11-test/test2/core/data/weather/surface-based-observation/synop</strong></p>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="_evaluate_6"><a class="anchor" href="#_evaluate_6"></a>Evaluate</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If the Global Broker discards all messages except one, makes it available on one of the two topics depending the WIS2 Node messages that arrived first.</p>
</li>
<li>
<p>The MQTT client received one message</p>
</li>
<li>
<p>Increments <strong>wmo_wis2_gb_messages_subscribed_total</strong> by 10 on both centre_id</p>
</li>
<li>
<p>Increments <strong>wmo_wis2_gb_messages_published_total</strong> by 1 on centre_id from the WIS2Node that arrives first (io-wis2dev-10-test or io-wis2dev-11-test)</p>
</li>
<li>
<p>If both statements are true, the test passes. Otherwise, the test fails.</p>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="_b_publishing_a_message_using_the_centre_id_from_a_different_wis2_node_test"><a class="anchor" href="#_b_publishing_a_message_using_the_centre_id_from_a_different_wis2_node_test"></a>B. Publishing a message using the centre_id from a different WIS2 Node Test</h6>

</div>
<div class="sect5">
<h6 id="_purpose_7"><a class="anchor" href="#_purpose_7"></a>Purpose</h6>
<div class="paragraph">
<p>The Global Broker service must ensure that any WIS2 Node is not publishing a message using a centre_id from another WIS2 Node</p>
</div>
</div>
<div class="sect5">
<h6 id="_requirements_7"><a class="anchor" href="#_requirements_7"></a>Requirements</h6>
<div class="ulist">
<ul>
<li>
<p>The container <a href="https://hub.docker.com/r/golfvert/fakewis2node" class="bare">https://hub.docker.com/r/golfvert/fakewis2node</a> deployed on 5 tests system (<strong>io-wis2dev-10-test</strong> to <strong>io-wis2dev-14-test</strong>)</p>
</li>
<li>
<p>Global Broker MQTT connection string to <strong>io-wis2dev-10-test</strong></p>
</li>
<li>
<p>MQTT Test Client</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_steps_7"><a class="anchor" href="#_steps_7"></a>Steps</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Have WIS2Node  <em>io-wis2dev-10-test</em> publish a valid message on topic Eg</p>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="_evaluate_7"><a class="anchor" href="#_evaluate_7"></a>Evaluate</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The Global Broker ignores (in fact the message will not be received at all) the message published. No metrics is incremented</p>
</li>
<li>
<p>If the message is received by MQTT Client then the test fails.</p>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="_c_publishing_messages_from_a_wis2_node_using_valid_topics_compliant_with_wis2_topic_hierarchy_test"><a class="anchor" href="#_c_publishing_messages_from_a_wis2_node_using_valid_topics_compliant_with_wis2_topic_hierarchy_test"></a>C. Publishing messages from a WIS2 Node using valid topics (compliant with WIS2 Topic Hierarchy) Test</h6>

</div>
<div class="sect5">
<h6 id="_purpose_8"><a class="anchor" href="#_purpose_8"></a>Purpose</h6>
<div class="paragraph">
<p>The Global Broker service must forward messages when the topic is compliant with the WIS2 Topic Hierarchy</p>
</div>
</div>
<div class="sect5">
<h6 id="_requirements_8"><a class="anchor" href="#_requirements_8"></a>Requirements</h6>
<div class="ulist">
<ul>
<li>
<p>The container <a href="https://hub.docker.com/r/golfvert/fakewis2node" class="bare">https://hub.docker.com/r/golfvert/fakewis2node</a> deployed on 5 tests system (<strong>io-wis2dev-10-test</strong> to <strong>io-wis2dev-14-test</strong>)</p>
</li>
<li>
<p>Global Broker MQTT connection string to a WIS2 Nodes (<strong>io-wis2dev-10-test</strong>)</p>
</li>
<li>
<p>MQTT Test Client</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_steps_8"><a class="anchor" href="#_steps_8"></a>Steps</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Have WIS2Node <strong>io-wis2dev-10-test</strong> publish <strong>valid</strong> messages on <strong>valid</strong> topics hierarchy (one message per tested valid topic)</p>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="_evaluate_8"><a class="anchor" href="#_evaluate_8"></a>Evaluate</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The Global Broker forward all messages</p>
</li>
<li>
<p>The MQTT client receives all messages</p>
</li>
<li>
<p>Increments <strong>wmo_wis2_gb_messages_subscribed_total</strong> by 1 for each message</p>
</li>
<li>
<p>Increments <strong>wmo_wis2_gb_messages_published_total</strong> by 1 for each message</p>
</li>
<li>
<p>If all above statements are true, the test passes. Otherwise, the test fails.</p>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="_d_publishing_messages_from_a_wis2_node_using_invalid_topics_not_compliant_with_wis2_topic_hierarchy_test"><a class="anchor" href="#_d_publishing_messages_from_a_wis2_node_using_invalid_topics_not_compliant_with_wis2_topic_hierarchy_test"></a>D. Publishing messages from a WIS2 Node using invalid topics (not compliant with WIS2 Topic Hierarchy) Test</h6>

</div>
<div class="sect5">
<h6 id="_purpose_9"><a class="anchor" href="#_purpose_9"></a>Purpose</h6>
<div class="paragraph">
<p>The Global Broker service must forward messages when the topic is compliant with the WIS2 Topic Hierarchy</p>
</div>
</div>
<div class="sect5">
<h6 id="_requirements_9"><a class="anchor" href="#_requirements_9"></a>Requirements</h6>
<div class="ulist">
<ul>
<li>
<p>The container <a href="https://hub.docker.com/r/golfvert/fakewis2node" class="bare">https://hub.docker.com/r/golfvert/fakewis2node</a> deployed on 5 tests system (<strong>io-wis2dev-10-test</strong> to <strong>io-wis2dev-14-test</strong>)</p>
</li>
<li>
<p>Global Broker MQTT connection string to a WIS2 Nodes (<strong>io-wis2dev-10-test</strong>)</p>
</li>
<li>
<p>MQTT Test Client</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_steps_9"><a class="anchor" href="#_steps_9"></a>Steps</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Have WIS2 Node <strong>io-wis2dev-10-test</strong> publish 10 <strong>valid</strong> messages on 10 <strong>different</strong> and <strong>invalid</strong> topics</p>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="_evaluate_9"><a class="anchor" href="#_evaluate_9"></a>Evaluate</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The Global Broker discards all messages</p>
</li>
<li>
<p>The MQTT client doesn&#8217;t receive any message</p>
</li>
<li>
<p>Increments <strong>wmo_wis2_gb_messages_subscribed_total</strong> by 10</p>
</li>
<li>
<p>Increments <strong>wmo_wis2_gb_messages_invalid_topic_total</strong> by 10</p>
</li>
<li>
<p>If all above statements are true, the test passes. Otherwise, the test fails.</p>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="_e_publishes_messages_from_a_wis2_node_on_a_valid_topic_without_corresponding_metadata_test"><a class="anchor" href="#_e_publishes_messages_from_a_wis2_node_on_a_valid_topic_without_corresponding_metadata_test"></a>E. Publishes messages from a WIS2 Node on a <em>valid</em> topic without corresponding metadata Test</h6>

</div>
<div class="sect5">
<h6 id="_purpose_10"><a class="anchor" href="#_purpose_10"></a>Purpose</h6>
<div class="paragraph">
<p>The Global Broker service must check that the topic used to publish a message by a WIS2 Node is announcing the availability of data with corresponding metadata.</p>
</div>
</div>
<div class="sect5">
<h6 id="_requirements_10"><a class="anchor" href="#_requirements_10"></a>Requirements</h6>
<div class="ulist">
<ul>
<li>
<p>The container <a href="https://hub.docker.com/r/golfvert/fakewis2node" class="bare">https://hub.docker.com/r/golfvert/fakewis2node</a> deployed on 5 tests system (<strong>io-wis2dev-10-test</strong> to <strong>io-wis2dev-14-test</strong>)</p>
</li>
<li>
<p>Global Broker MQTT connection string to a WIS2 Nodes (<strong>io-wis2dev-10-test</strong>)</p>
</li>
<li>
<p>MQTT Test Client</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_steps_10"><a class="anchor" href="#_steps_10"></a>Steps</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Have WIS2 Node <strong>io-wis2dev-10-test</strong> publish 10 <strong>valid</strong> messages on 10 <strong>different</strong> topics, and no metadata exists for any topic used.</p>
</li>
<li>
<p>e.g Publish on <strong>origin/a/wis2/ <em>io-wis2dev-10-test</em>/core/data/weather/surface-based-observation/synop</strong> and WIS2 Node <strong>io-wis2dev-10-test</strong> has not published a metadata record for the synop.</p>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="_evaluate_10"><a class="anchor" href="#_evaluate_10"></a>Evaluate</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The Global Broker discards all messages</p>
</li>
<li>
<p>The MQTT client doesn&#8217;t receive any message</p>
</li>
<li>
<p>Increments <strong>wmo_wis2_gb_messages_subscribed_total</strong> by 10</p>
</li>
<li>
<p>Increments <strong>wmo_wis2_gb_messages_no_metadata_total</strong> by 10</p>
</li>
<li>
<p>If all above statements are true, the test passes. Otherwise, the test fails.</p>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="_f_verifying_the_compliance_of_a_wis2_notification_message_test"><a class="anchor" href="#_f_verifying_the_compliance_of_a_wis2_notification_message_test"></a>F. Verifying the compliance of a WIS2 Notification message Test</h6>

</div>
<div class="sect5">
<h6 id="_purpose_11"><a class="anchor" href="#_purpose_11"></a>Purpose</h6>
<div class="paragraph">
<p>The Global Broker service must verify the compliance of the WIS2 Notification Message with the agreed standard as specified in the Manual on WIS Vol. 2</p>
</div>
</div>
<div class="sect5">
<h6 id="_requirements_11"><a class="anchor" href="#_requirements_11"></a>Requirements</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The container <a href="https://hub.docker.com/r/golfvert/fakewis2node" class="bare">https://hub.docker.com/r/golfvert/fakewis2node</a> deployed on 5 tests system (<strong>io-wis2dev-10-test</strong> to <strong>io-wis2dev-14-test</strong>)</p>
</li>
<li>
<p>Global Broker MQTT connection string to a WIS2 Nodes (<strong>io-wis2dev-10-test</strong>)</p>
</li>
<li>
<p>MQTT Test Client</p>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="_steps_11"><a class="anchor" href="#_steps_11"></a>Steps</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Have WIS2 Node <strong>io-wis2dev-10-test</strong> publish 10 <strong>invalid</strong> messages on 10 <strong>valid</strong> topics</p>
</li>
<li>
<p>All mandatory fields of the WIS2 Notification Messages must be tested</p>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="_evaluate_11"><a class="anchor" href="#_evaluate_11"></a>Evaluate</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The Global Broker discards all messages</p>
</li>
<li>
<p>The MQTT client doesn&#8217;t receive any message</p>
</li>
<li>
<p>Increments <strong>wmo_wis2_gb_messages_subscribed_total</strong> by 10</p>
</li>
<li>
<p>Increments <strong>wmo_wis2_gb_messages_invalid_messages_total</strong> by 10</p>
</li>
<li>
<p>If all above statements are true, the test passes. Otherwise, the test fails.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_3_global_broker_performance_testing"><a class="anchor" href="#_3_global_broker_performance_testing"></a>7.1.1.3. 3. Global Broker Performance Testing</h5>
<div class="paragraph">
<p>We must ensure that the Global Broker service performs properly under stress.  The following outlined tests will test the Global Broker service prior to transition of WIS2 to an operational state on January 1, 2025</p>
</div>
<div class="sect5">
<h6 id="_a_global_broker_minimum_number_of_wis2_nodes_test"><a class="anchor" href="#_a_global_broker_minimum_number_of_wis2_nodes_test"></a>A. Global Broker minimum number of WIS2 Nodes Test</h6>

</div>
<div class="sect5">
<h6 id="_purpose_12"><a class="anchor" href="#_purpose_12"></a>Purpose</h6>
<div class="paragraph">
<p>The Global Broker service should support a minimum of <strong>200</strong> WIS2 Nodes</p>
</div>
</div>
<div class="sect5">
<h6 id="_requirements_12"><a class="anchor" href="#_requirements_12"></a>Requirements</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The container <a href="https://hub.docker.com/r/golfvert/benchmarkwis2gb" class="bare">https://hub.docker.com/r/golfvert/benchmarkwis2gb</a> deployed on 5 tests system</p>
</li>
<li>
<p>Global Broker subscribing to <strong>200</strong> WIS2 Nodes (<strong>io-wis2dev-100-test</strong> to <strong>io-wis2dev-299-test</strong>)</p>
</li>
<li>
<p>MQTT Test Client</p>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="_steps_12"><a class="anchor" href="#_steps_12"></a>Steps</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On each of the 200 WIS2 Nodes, publish 10 <strong>valid</strong> messages, on <strong>valid</strong> topic, without associated metadata, and with different <strong>id</strong> messages</p>
</li>
<li>
<p>On the MQTT test client, subscribe to <strong>origin/a/wis2/#</strong></p>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="_evaluate_12"><a class="anchor" href="#_evaluate_12"></a>Evaluate</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If on the MQTT test client, 10 messages for each of the 200 centre-id are received, the test passes. Otherwise, it fails.</p>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="_b_global_broker_minimum_number_of_subscribers_test"><a class="anchor" href="#_b_global_broker_minimum_number_of_subscribers_test"></a>B. Global Broker minimum number of subscribers Test</h6>

</div>
<div class="sect5">
<h6 id="_purpose_13"><a class="anchor" href="#_purpose_13"></a>Purpose</h6>
<div class="paragraph">
<p>The Global Broker service should support a minimum of <strong>1000</strong> subscribers.</p>
</div>
</div>
<div class="sect5">
<h6 id="_requirements_13"><a class="anchor" href="#_requirements_13"></a>Requirements</h6>
<div class="ulist">
<ul>
<li>
<p>Global Broker</p>
</li>
<li>
<p>MQTTX CLI (<a href="https://mqttx.app/docs/cli" class="bare">https://mqttx.app/docs/cli</a>) deployed on 5 tests systems</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_steps_13"><a class="anchor" href="#_steps_13"></a>Steps</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use MQTTX CLI <em>bench</em> on each test system to simulate 200 clients by using <code>mqttx bench conn -c 200 -i 100</code> and the relevant connection information for the Global Broker being tested.</p>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="_evaluate_13"><a class="anchor" href="#_evaluate_13"></a>Evaluate</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If the output of the command on each test system is similar to:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>mqttx bench conn -c 200 -i 100
❯  Starting connect benchmark, connections: 200, req interval: 100ms
✔  [200/200] - Connected
✔  Created 200 connections in 22.355s</code></pre>
</div>
</div>
<div class="paragraph">
<p>with 200 connections created, on the 5 tests systems, this test is successful.</p>
</div>
</div>
<div class="sect5">
<h6 id="_c_global_broker_minimum_number_of_messages_per_second_test"><a class="anchor" href="#_c_global_broker_minimum_number_of_messages_per_second_test"></a>C. Global Broker minimum number of messages per second Test</h6>

</div>
<div class="sect5">
<h6 id="_purpose_14"><a class="anchor" href="#_purpose_14"></a>Purpose</h6>
<div class="paragraph">
<p>The Global Broker service should support processing of a minimum of <strong>10000</strong> messages per second.</p>
</div>
</div>
<div class="sect5">
<h6 id="_requirements_14"><a class="anchor" href="#_requirements_14"></a>Requirements</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The container <a href="https://hub.docker.com/r/golfvert/benchmarkwis2gb" class="bare">https://hub.docker.com/r/golfvert/benchmarkwis2gb</a> deployed on 5 tests system (different from above)</p>
</li>
<li>
<p>Global Broker subscribing to <strong>200</strong> WIS2 Nodes (<strong>io-wis2dev-100-test</strong> to <strong>io-wis2dev-299-test</strong>)</p>
</li>
<li>
<p>MQTTX CLI deployed on 5 tests systems.</p>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="_steps_14"><a class="anchor" href="#_steps_14"></a>Steps</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On each of the 200 WIS2 Nodes, publish X <strong>valid</strong> messages per second during Y seconds, on a <strong>valid</strong> topic, without associated metadata or data, and with different <strong>id</strong> messages</p>
</li>
<li>
<p>Use MQTTX CLI <em>bench</em> on each test VMs to simulate Z clients by using <code>mqttx bench sub -c Z -t origin/a/wis2/#</code> and the relevant connection information for the Global Broker being tested.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Typically with:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>With X = 5 messages per second on each of the 200 WIS2 Nodes, this will create 1000 messages per second</p>
</li>
<li>
<p>With Z = 2 on each VM, this will create 10 subscriptions.</p>
</li>
<li>
<p>As every subscriber will get all messages will be equivalent to <strong>10000</strong> messages per second.</p>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="_evaluate_14"><a class="anchor" href="#_evaluate_14"></a>Evaluate</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Run the test for 30 seconds (Y=30), if MQTTS CLI output shows that 300000 are received, then the test is successful.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="global-cache-testing"><a class="anchor" href="#global-cache-testing"></a>7.2. Global Cache Service testing</h3>
<div class="sect3">
<h4 id="_functional_tests_2"><a class="anchor" href="#_functional_tests_2"></a>7.2.1. Functional Tests</h4>
<div class="sect4">
<h5 id="_1_mqtt_broker_connectivity"><a class="anchor" href="#_1_mqtt_broker_connectivity"></a>7.2.1.1. 1. MQTT Broker Connectivity</h5>
<div class="sect5">
<h6 id="_purpose_15"><a class="anchor" href="#_purpose_15"></a>Purpose</h6>
<div class="paragraph">
<p>An MQTT client must be able to connect to the local broker of the Global Cache on port 8883 using the MQTT protocol version 5 with TLS (i.e., mqtts protocol) and username/password authentication.</p>
</div>
<div class="paragraph">
<p><strong>Source:</strong> Manual on WIS (WMO No. 1060), Vol II, clause 3.7.5.2: A Global Cache shall operate a message broker.</p>
</div>
</div>
<div class="sect5">
<h6 id="_requirements_15"><a class="anchor" href="#_requirements_15"></a>Requirements</h6>
<div class="ulist">
<ul>
<li>
<p>GC MQTT broker connection string</p>
</li>
<li>
<p>MQTT Test Client</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_steps_15"><a class="anchor" href="#_steps_15"></a>Steps</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Initialize the test MQTT client with the necessary parameters such as the MQTT protocol version 5, TLS security, and username/password for authentication (connection string).</p>
</li>
<li>
<p>Attempt to connect the MQTT broker of the Global Cache using the connection string.</p>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="_evaluate_15"><a class="anchor" href="#_evaluate_15"></a>Evaluate</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Check if the connection is successful (rc code). If the connection is successful, the test passes. If the connection is not successful, the test fails.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_2_gc_mqtt_broker_subscription"><a class="anchor" href="#_2_gc_mqtt_broker_subscription"></a>7.2.1.2. 2. GC MQTT Broker Subscription</h5>
<div class="sect5">
<h6 id="_purpose_16"><a class="anchor" href="#_purpose_16"></a>Purpose</h6>
<div class="paragraph">
<p>A Global Cache must allow connected MQTT clients to subscribe to the cache/a/wis2/# topic using a provided connection string.</p>
</div>
</div>
<div class="sect5">
<h6 id="_requirements_16"><a class="anchor" href="#_requirements_16"></a>Requirements</h6>
<div class="ulist">
<ul>
<li>
<p>GC MQTT broker connection string</p>
</li>
<li>
<p>MQTT Test Client</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_steps_16"><a class="anchor" href="#_steps_16"></a>Steps</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Initialize a MQTT client with the necessary parameters such as the MQTT protocol version 5, TLS security, and username/password for authentication (connection string).</p>
</li>
<li>
<p>Connect the MQTT client to the local broker of the Global Cache.</p>
</li>
<li>
<p>Once the connection is successful, attempt to subscribe to the <code>cache/a/wis2/#</code> topic.</p>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="_evaluate_16"><a class="anchor" href="#_evaluate_16"></a>Evaluate</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Check if the subscription is successful. If the subscription is successful based on the returned rc code (SUBACK), the test passes. If the subscription is not successful, the test fails.</p>
</li>
<li>
<p>Close the connection to the broker after the test.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_3_wis2_notification_message_wnm_processing"><a class="anchor" href="#_3_wis2_notification_message_wnm_processing"></a>7.2.1.3. 3. WIS2 Notification Message (WNM) Processing</h5>
<div class="sect5">
<h6 id="_purpose_17"><a class="anchor" href="#_purpose_17"></a>Purpose</h6>
<div class="paragraph">
<p>Test that the GC functions as expected under normal conditions. The Global Cache should process a valid incoming WNM, download the data at the provided canonical link, and publish a new WNM on the proper cache/ topic using the proper message structure, and update the necessary GC metrics.</p>
</div>
<div class="paragraph">
<p>This test also evaluates the client data download requirement: An HTTP client (i.e., a Web browser) must be able to connect to the HTTP server of the Global Cache on port 443 using HTTP 1.1 with TLS but without any authentication and be able to resolve the URL provided in a data download link (a link object&#8217;s <code>href</code> property where <code>rel=canonical</code>) from a notification message published by the Global Cache within the previous 24 hours; i.e., download a cached data item.</p>
</div>
<div class="paragraph">
<p><strong>Source:</strong> Manual on WIS (WMO No. 1060), Vol II, clause 3.7.5.5: A Global Cache shall provide highly available access to copies of discovery metadata records and core data it stores; clause 3.7.5.6: A Global Cache shall retain a copy of the discovery metadata records and core data it stores for a duration compatible with the real-time or near-real-time schedule of the data and not less than 24 hours; clause 4.5.2: A Global Cache shall download core data and discovery metadata from [WIS2 Nodes] and other Global [Services] to provide for reliable, low-latency access to those resources via WIS; clause 4.5.6: Data and discovery metadata available for download from a Global Cache shall be accessible via a URL using at least one of the protocols specified [&#8230;&#8203;].</p>
</div>
<div class="paragraph">
<p><strong>Source:</strong> Manual on WIS (WMO No. 1060), Vol II, clause 3.7.5.4: Based on the notifications it receives, a Global Cache shall download and store a copy of discovery metadata records and core data from [WIS2 Nodes] and other Global [Services]; clause 3.7.5.7: A Global Cache shall publish notifications via its Message Broker about copies of the discovery metadata records and core data it makes available. A Global Cache shall use a standardized topic structure when publishing notifications; clause 4.5.2: A Global Cache shall download core data and discovery metadata from [WIS2 Nodes] and other Global [Services] to provide for reliable, low-latency access to those resources via WIS; clause 4.5.4: Based on received notifications, a Global Cache shall download core data from [WIS2 Nodes] or other Global [Services] and store them for a minimum duration of 24 hours; clause 4.5.5: Based on its received notifications, a Global Cache shall download discovery metadata records from [WIS2 Nodes] or other Global [Services] and store them for a minimum duration of 24 hours; clause 4.5.7: A Global Cache shall publish notifications to a Message Broker indicating  the availability of data and discovery metadata resources from the Global Cache and shall use the format and protocol specified [&#8230;&#8203;].</p>
</div>
<div class="paragraph">
<p><strong>Source:</strong> Guide to WIS (WMO No. 1061), Vol II, clause 2.7.4.1. [Global Cache] Technical considerations <a href="https://wmo-im.github.io/wis2-guide/guide/wis2-guide-DRAFT.html#_technical_considerations_2" class="bare">https://wmo-im.github.io/wis2-guide/guide/wis2-guide-DRAFT.html#_technical_considerations_2</a>; clause 2.7.4.2. [Global Cache] Practices and procedures <a href="https://wmo-im.github.io/wis2-guide/guide/wis2-guide-DRAFT.html#_practices_and_procedures_2" class="bare">https://wmo-im.github.io/wis2-guide/guide/wis2-guide-DRAFT.html#_practices_and_procedures_2</a></p>
</div>
</div>
<div class="sect5">
<h6 id="_requirements_17"><a class="anchor" href="#_requirements_17"></a>Requirements</h6>
<div class="ulist">
<ul>
<li>
<p>Dev/test GB MQTT broker connection string</p>
<div class="ulist">
<ul>
<li>
<p>MQTT user is able to read and write messages on the <code>origin/a/wis2/<mark></code> and <code>cache/a/wis2/</mark></code> topics.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Dev/test GC is initiated and connected to the dev/test GB with subscriptions to the following topics:</p>
<div class="ulist">
<ul>
<li>
<p>origin/a/wis2/+/data/#</p>
</li>
<li>
<p>cache/a/wis2/+/data/#</p>
</li>
<li>
<p>origin/a/wis2/+/metadata/#</p>
</li>
<li>
<p>cache/a/wis2/+/metadata/#</p>
</li>
</ul>
</div>
</li>
<li>
<p>MQTT test client</p>
<div class="ulist">
<ul>
<li>
<p>Client should connect to the dev/test GB MQTT broker using the provided connection string to control the input and monitor the output.</p>
</li>
</ul>
</div>
</li>
<li>
<p>GC metrics scraper</p>
</li>
<li>
<p>Prepared WIS2 Notification Messages and associated data objects:</p>
<div class="ulist">
<ul>
<li>
<p>A known number <strong><a href="https://github.com/wmo-im/wis2-notification-message">valid</a></strong> WNM&#8217;s with:</p>
<div class="ulist">
<ul>
<li>
<p><code>properties.cache</code> set to true</p>
</li>
<li>
<p><code>properties.data_id</code> + <code>properties.pubtime</code> should be unique to each message. Ensuring a different data_id is best here.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Accompanying data objects should be accessible via the canonical link provided in the WNM.</p>
<div class="ulist">
<ul>
<li>
<p>The canonical link should be accessible per the core requirements and the data object hash should match the hash provided in the WNM if integrity properties are provided.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_steps_17"><a class="anchor" href="#_steps_17"></a>Steps</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Configure the MQTT test client to connect to the dev/test GB MQTT broker using the provided connection string.</p>
</li>
<li>
<p>Publish a batch of Prepared WIS2 Notification Messages to the dev/test GB on following topics:</p>
<div class="ulist">
<ul>
<li>
<p>Send 1 or more messages to origin/a/wis2/+/data/#</p>
</li>
<li>
<p>Send 1 or more messages to cache/a/wis2/+/data/#</p>
</li>
<li>
<p>Send 1 or more messages to origin/a/wis2/+/metadata/#</p>
</li>
<li>
<p>Send 1 or more messages to cache/a/wis2/+/metadata/#</p>
</li>
</ul>
</div>
</li>
<li>
<p>The test MQTT client should store the messages received on the <code>cache/a/wis2/#</code> topic published by the GC and download the data objects from the canonical link provided in the messages using HTTP 1.1 with TLS.</p>
<div class="ulist">
<ul>
<li>
<p>The original data object and the downloaded&gt;&gt;cached data objects can then be compared to ensure they are identical.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="_evaluate_17"><a class="anchor" href="#_evaluate_17"></a>Evaluate</h6>
<div class="ulist">
<ul>
<li>
<p>WNM Messages</p>
<div class="ulist">
<ul>
<li>
<p>The total number of cache notification messages published by the GC on the cache/a/wis2/# topic.</p>
</li>
<li>
<p>All messages should be the same as the source WNM&#8217;s except for:</p>
<div class="ulist">
<ul>
<li>
<p>The canonical link (a link object&#8217;s <code>href</code> property where <code>rel=canonical</code>), this should point to the GC&#8217;s cached object.</p>
</li>
<li>
<p>the unique identifier of the message (id)</p>
</li>
<li>
<p>The topic, always on the <code>cache</code> channel. Note the incoming message may be unchanged if it was originally published on the <code>cache</code> channel.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Data Objects</p>
<div class="ulist">
<ul>
<li>
<p>The total number of data objects cached by the GC. This should match the number of cache notification messages published.</p>
</li>
<li>
<p>The data objects cached by the GC should be identical to the source data objects.</p>
<div class="ulist">
<ul>
<li>
<p>The diff or hashes of the data objects should be identical.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>GC Metrics</p>
<div class="ulist">
<ul>
<li>
<p><code>wmo_wis2_gc_download_total</code> (matches total messages)</p>
</li>
<li>
<p><code>wmo_wis2_gc_dataserver_status_flag</code> (set to 1 for each)</p>
</li>
<li>
<p><code>wmo_wis2_gc_dataserver_last_download_timestamp_seconds</code> (set for each and within expected time range)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_4_cache_false_directive"><a class="anchor" href="#_4_cache_false_directive"></a>7.2.1.4. 4. Cache False Directive</h5>
<div class="sect5">
<h6 id="_purpose_18"><a class="anchor" href="#_purpose_18"></a>Purpose</h6>
<div class="paragraph">
<p>Where a Global Cache receives a notification message with <em>properties.cache</em> set to false, the Global Cache should publish a notification message where the data download link (a link object&#8217;s <code>href</code> property where <code>rel=canonical</code>) refers to the source data server.</p>
</div>
</div>
<div class="sect5">
<h6 id="_requirements_18"><a class="anchor" href="#_requirements_18"></a>Requirements</h6>
<div class="ulist">
<ul>
<li>
<p>Dev/test GB MQTT broker connection string</p>
<div class="ulist">
<ul>
<li>
<p>MQTT user is able to read and write messages on the <code>origin/a/wis2/<mark></code> and <code>cache/a/wis2/</mark></code> topics.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Dev/test GC is initiated with subscription to the <code>cache/a/wis2/<mark></code> topic and <code>origin/a/wis2/</mark></code> topic of the dev/test GB.</p>
</li>
<li>
<p>MQTT test client</p>
<div class="ulist">
<ul>
<li>
<p>Client should connect to both the dev/test GB MQTT broker using the provided connection string to control the input and monitor the output.</p>
</li>
</ul>
</div>
</li>
<li>
<p>GC metrics scraper</p>
</li>
<li>
<p>Prepared WIS2 Notification Messages and data objects:</p>
<div class="ulist">
<ul>
<li>
<p>A known number <strong><a href="https://github.com/wmo-im/wis2-notification-message">valid</a></strong> WNM&#8217;s with:</p>
<div class="ulist">
<ul>
<li>
<p><code>properties.cache</code> set to <mark>false</mark></p>
</li>
<li>
<p><code>properties.data_id</code> + <code>properties.pubtime</code> should be unique to each message.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Accompanying data objects are not required for this test.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_steps_18"><a class="anchor" href="#_steps_18"></a>Steps</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Configure the MQTT test client to connect to the dev/test GB MQTT broker using the provided connection string.</p>
</li>
<li>
<p>Publish the prepared WIS2 Notification Messages to the dev/test GB the following topics:</p>
<div class="ulist">
<ul>
<li>
<p>Send 1 or more messages to origin/a/wis2/+/data/#</p>
</li>
<li>
<p>Send 1 or more messages to cache/a/wis2/+/data/#</p>
</li>
<li>
<p>Send 1 or more messages to origin/a/wis2/+/metadata/#</p>
</li>
<li>
<p>Send 1 or more messages to cache/a/wis2/+/metadata/#</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="_evaluate_18"><a class="anchor" href="#_evaluate_18"></a>Evaluate</h6>
<div class="ulist">
<ul>
<li>
<p>WNM Messages</p>
<div class="ulist">
<ul>
<li>
<p>The total number of cache notification messages published by the GC on the <code>cache/a/wis2/#</code> topic</p>
</li>
<li>
<p>all messages should be the same as the source WNM&#8217;s except for:</p>
<div class="ulist">
<ul>
<li>
<p>the unique identifier of the message (id)</p>
</li>
<li>
<p>the topic (<code>cache/a/wis2/&#8230;&#8203;</code>) (note the incoming message may be on the same <code>cache/#</code> topic if it is from another GC)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>GC Metrics</p>
<div class="ulist">
<ul>
<li>
<p><code>wmo_wis2_gc_download_total</code> (unchanged)</p>
</li>
<li>
<p><code>wmo_wis2_gc_dataserver_status_flag</code> (unchanged)</p>
</li>
<li>
<p><code>wmo_wis2_gc_dataserver_last_download_timestamp_seconds</code> (unchanged)</p>
</li>
<li>
<p><code>wmo_wis2_gc_no_cache_total</code> (+=1 for each WNM)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_5_source_download_failure"><a class="anchor" href="#_5_source_download_failure"></a>7.2.1.5. 5. Source Download Failure</h5>
<div class="sect5">
<h6 id="_purpose_19"><a class="anchor" href="#_purpose_19"></a>Purpose</h6>
<div class="paragraph">
<p>Where a Global Cache receives a valid WNM, but is unable to download a data item from the location specified in a notification message (i.e., the source data server), the <code>metric wmo_wis2_gc_dataserver_status_flag</code> for the source data server should be set to 0 (zero).</p>
</div>
</div>
<div class="sect5">
<h6 id="_requirements_19"><a class="anchor" href="#_requirements_19"></a>Requirements</h6>
<div class="ulist">
<ul>
<li>
<p>Dev/test GB MQTT broker connection string</p>
<div class="ulist">
<ul>
<li>
<p>MQTT user is able to read and write messages on the <code>origin/a/wis2/<mark></code> and <code>cache/a/wis2/</mark></code> topics.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Dev/test GC is initiated with subscription to the <code>cache/a/wis2/<mark></code> topic and <code>origin/a/wis2/</mark></code> topic of the dev/test GB.</p>
</li>
<li>
<p>MQTT test client</p>
<div class="ulist">
<ul>
<li>
<p>Client should connect the dev/test GB MQTT broker using the provided connection string to control the input and monitor the output.</p>
</li>
</ul>
</div>
</li>
<li>
<p>GC metrics scraper</p>
</li>
<li>
<p>Prepared WIS2 Notification Messages and data objects</p>
<div class="ulist">
<ul>
<li>
<p>A known number <strong><a href="https://github.com/wmo-im/wis2-notification-message">valid</a></strong> WNM&#8217;s with:</p>
<div class="ulist">
<ul>
<li>
<p><mark>invalid</mark> data download links (a link object&#8217;s <code>href</code> property where <code>rel=canonical</code>)</p>
</li>
<li>
<p><code>properties.data_id</code> + <code>properties.pubtime</code> should be unique to each message.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Accompanying data objects are not required for this test.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_steps_19"><a class="anchor" href="#_steps_19"></a>Steps</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Configure the MQTT test client to connect to the dev/test MQTT broker using the provided connection string.</p>
</li>
<li>
<p>Publish the prepared WNM&#8217;s to the dev/test GB on one or more of the following topics:</p>
<div class="ulist">
<ul>
<li>
<p>origin/a/wis2/+/data/#</p>
</li>
<li>
<p>cache/a/wis2/+/data/#</p>
</li>
<li>
<p>origin/a/wis2/+/metadata/#</p>
</li>
<li>
<p>cache/a/wis2/+/metadata/#</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="_evaluate_19"><a class="anchor" href="#_evaluate_19"></a>Evaluate</h6>
<div class="ulist">
<ul>
<li>
<p>WNM Messages</p>
<div class="ulist">
<ul>
<li>
<p>No messages should be published on the <code>cache/a/wis2/#</code> topic as received by the test MQTT client.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Data Objects</p>
<div class="ulist">
<ul>
<li>
<p>No data objects should be cached by the GC.</p>
</li>
</ul>
</div>
</li>
<li>
<p>GC Metrics</p>
<div class="ulist">
<ul>
<li>
<p><code>wmo_wis2_gc_download_total</code> (unchanged)</p>
</li>
<li>
<p><code>wmo_wis2_gc_dataserver_status_flag</code> (set to 0 for each)</p>
</li>
<li>
<p><code>wmo_wis2_gc_dataserver_last_download_timestamp_seconds</code> (unchanged)</p>
</li>
<li>
<p><code>wmo_wis2_gc_downloaded_errors_total</code> (+=1 for each WNM)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_6_cache_override_optional"><a class="anchor" href="#_6_cache_override_optional"></a>7.2.1.6. 6. Cache Override (Optional)</h5>
<div class="sect5">
<h6 id="_purpose_20"><a class="anchor" href="#_purpose_20"></a>Purpose</h6>
<div class="paragraph">
<p>Where a Global Cache determines that it is unable to cache a data item, the Global Cache should publish a notification message where the data download link (a link object&#8217;s <code>href</code> property where <code>rel=canonical</code>) refers to the source data server, and the metric <code>wmo_wis2_gc_cache_override_total</code> is incremented by 1 (one).
Note that the trigger for this directive is implementation specific. The criteria must be known and enabled for the test
to be valid. Additionally, a given GC may decide to NOT implement this directive and thus this test is included as optional.</p>
</div>
</div>
<div class="sect5">
<h6 id="_requirements_20"><a class="anchor" href="#_requirements_20"></a>Requirements</h6>
<div class="ulist">
<ul>
<li>
<p>Dev/test GB MQTT broker connection string</p>
<div class="ulist">
<ul>
<li>
<p>MQTT user is able to read and write messages on the <code>origin/a/wis2/<mark></code> and <code>cache/a/wis2/</mark></code> topics.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Dev/test GC is initiated with subscription to the <code>cache/a/wis2/<mark></code> topic and <code>origin/a/wis2/</mark></code> topic of the dev/test GB.</p>
</li>
<li>
<p>MQTT test client</p>
<div class="ulist">
<ul>
<li>
<p>Client should connect to the dev/test GB MQTT broker using the provided connection string to control the input and monitor the output.</p>
</li>
</ul>
</div>
</li>
<li>
<p>GC metrics scraper</p>
</li>
<li>
<p>Prepared WIS2 Notification Messages and data objects</p>
<div class="ulist">
<ul>
<li>
<p>A known number <strong><a href="https://github.com/wmo-im/wis2-notification-message">valid</a></strong> WNM&#8217;s with:</p>
<div class="ulist">
<ul>
<li>
<p><code>properties.cache</code> set to <mark>true</mark></p>
</li>
<li>
<p><code>properties.data_id</code> + <code>properties.pubtime</code> should be unique to each message.</p>
</li>
<li>
<p><mark>The known properties that trigger the cache override directive.</mark></p>
</li>
</ul>
</div>
</li>
<li>
<p>Accompanying data objects are not required for this test.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_steps_20"><a class="anchor" href="#_steps_20"></a>Steps</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Configure the MQTT test client to connect to the dev/test GB broker using the provided connection string.</p>
</li>
<li>
<p>Publish the perpared WNM&#8217;s to the dev/test GB on one or more of the following topics:</p>
<div class="ulist">
<ul>
<li>
<p>origin/a/wis2/+/data/#</p>
</li>
<li>
<p>cache/a/wis2/+/data/#</p>
</li>
<li>
<p>origin/a/wis2/+/metadata/#</p>
</li>
<li>
<p>cache/a/wis2/+/metadata/#</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="_evaluate_20"><a class="anchor" href="#_evaluate_20"></a>Evaluate</h6>
<div class="ulist">
<ul>
<li>
<p>Topic</p>
<div class="ulist">
<ul>
<li>
<p>No messages should be published on the <code>cache/a/wis2/#</code> topic as received by the test MQTT client.</p>
</li>
</ul>
</div>
</li>
<li>
<p>WNM Messages</p>
<div class="ulist">
<ul>
<li>
<p>No messages should be published on the <code>cache/a/wis2/#</code> topic as received by the test MQTT client.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Data Objects</p>
<div class="ulist">
<ul>
<li>
<p>No data objects should be cached by the GC.</p>
</li>
</ul>
</div>
</li>
<li>
<p>GC Metrics</p>
<div class="ulist">
<ul>
<li>
<p>The following metrics are updated as expected per the prepared test data set:</p>
<div class="ulist">
<ul>
<li>
<p><code>wmo_wis2_gc_download_total</code> (unchanged)</p>
</li>
<li>
<p><code>wmo_wis2_gc_dataserver_status_flag</code> (unchanged)</p>
</li>
<li>
<p><code>wmo_wis2_gc_dataserver_last_download_timestamp_seconds</code> (unchanged)</p>
</li>
<li>
<p><code>wmo_wis2_gc_cache_override_total</code> (+=1 for each WNM)</p>
</li>
<li>
<p><code>wmo_wis2_gc_downloaded_errors_total</code> (unchanged)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_7_data_integrity_check_failure_recommended"><a class="anchor" href="#_7_data_integrity_check_failure_recommended"></a>7.2.1.7. 7. Data Integrity Check Failure (Recommended)</h5>
<div class="sect5">
<h6 id="_purpose_21"><a class="anchor" href="#_purpose_21"></a>Purpose</h6>
<div class="paragraph">
<p>A Global Cache should validate the integrity of the resources it caches and only accept data which matches the integrity value from the WIS Notification Message. If the WIS Notification Message does not contain an integrity value, a Global Cache should accept the data as valid. In this case a Global Cache <em>may</em> add an integrity value to the message it republishes.</p>
</div>
<div class="paragraph">
<p><strong>Source:</strong> Guide to WIS (WMO No. 1061), Vol II, clause 2.7.4.1. [Global Cache] Technical considerations <a href="https://wmo-im.github.io/wis2-guide/guide/wis2-guide-DRAFT.html#_technical_considerations_2" class="bare">https://wmo-im.github.io/wis2-guide/guide/wis2-guide-DRAFT.html#_technical_considerations_2</a>; clause 2.7.4.2. [Global Cache] Practices and procedures <a href="https://wmo-im.github.io/wis2-guide/guide/wis2-guide-DRAFT.html#_practices_and_procedures_2" class="bare">https://wmo-im.github.io/wis2-guide/guide/wis2-guide-DRAFT.html#_practices_and_procedures_2</a>
<strong>Source:</strong> <a href="https://github.com/wmo-im/wis2-notification-message/blob/main/standard/recommendations/core/REC_integrity.adoc" class="bare">https://github.com/wmo-im/wis2-notification-message/blob/main/standard/recommendations/core/REC_integrity.adoc</a></p>
</div>
</div>
<div class="sect5">
<h6 id="_requirements_21"><a class="anchor" href="#_requirements_21"></a>Requirements</h6>
<div class="ulist">
<ul>
<li>
<p>Dev/test GB MQTT broker connection string</p>
<div class="ulist">
<ul>
<li>
<p>MQTT user is able to read and write messages on the <code>origin/a/wis2/<mark></code> and <code>cache/a/wis2/</mark></code> topics.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Dev/test GC is initiated with subscription to the <code>cache/a/wis2/<mark></code> topic and <code>origin/a/wis2/</mark></code> topic of the dev/test GB.</p>
</li>
<li>
<p>MQTT test client</p>
<div class="ulist">
<ul>
<li>
<p>Client should connect to the dev/test GB MQTT broker using the provided connection string to control the input and monitor the output.</p>
</li>
</ul>
</div>
</li>
<li>
<p>GC metrics scraper</p>
</li>
<li>
<p>Prepared WIS2 Notification Messages and data objects</p>
<div class="ulist">
<ul>
<li>
<p>A known number <strong><a href="https://github.com/wmo-im/wis2-notification-message">valid</a></strong> WNM&#8217;s with:</p>
<div class="ulist">
<ul>
<li>
<p><mark>invalid</mark> data integrity value (accessed via <code>properties.integrity.value</code> and the method specified in <code>properties.integrity.method</code>)</p>
</li>
<li>
<p><code>properties.data_id</code> + <code>properties.pubtime</code> should be unique to each message.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Accompanying data objects that are accessible via the canonical link provided in the WNM</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_steps_21"><a class="anchor" href="#_steps_21"></a>Steps</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Publish the prepared WNM&#8217;s to the dev/test GB on one or more of the following topics:</p>
<div class="ulist">
<ul>
<li>
<p>origin/a/wis2/+/data/#</p>
</li>
<li>
<p>cache/a/wis2/+/data/#</p>
</li>
<li>
<p>origin/a/wis2/+/metadata/#</p>
</li>
<li>
<p>cache/a/wis2/+/metadata/#</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="_evaluate_21"><a class="anchor" href="#_evaluate_21"></a>Evaluate</h6>
<div class="ulist">
<ul>
<li>
<p>WNM Messages</p>
<div class="ulist">
<ul>
<li>
<p>No messages should be published on the <code>cache/a/wis2/#</code> topic as received by the test MQTT client.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Data Objects</p>
<div class="ulist">
<ul>
<li>
<p>No data objects should be cached by the GC.</p>
</li>
</ul>
</div>
</li>
<li>
<p>GC Metrics</p>
<div class="ulist">
<ul>
<li>
<p><code>wmo_wis2_gc_download_total</code> (unchanged)</p>
</li>
<li>
<p><code>wmo_wis2_gc_dataserver_status_flag</code> (set to 0 for each)</p>
</li>
<li>
<p><code>wmo_wis2_gc_dataserver_last_download_timestamp_seconds</code> (unchanged)</p>
</li>
<li>
<p><code>wmo_wis2_gc_downloaded_errors_total</code> (+=1 for each WNM)</p>
</li>
<li>
<p><code>wmo_wis2_gc_integrity_failed_total</code> (+=1 for each WNM)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_8_wis2_notification_message_deduplication"><a class="anchor" href="#_8_wis2_notification_message_deduplication"></a>7.2.1.8. 8. WIS2 Notification Message Deduplication</h5>
<div class="sect5">
<h6 id="_purpose_22"><a class="anchor" href="#_purpose_22"></a>Purpose</h6>
<div class="paragraph">
<p>A Global Cache must ensure that only one instance of a notification message with a given unique identifier (id) is successfully processed.</p>
</div>
<div class="paragraph">
<p><strong>Source:</strong> Manual on WIS (WMO No. 1060), Vol II, clause 3.7.5.3: A Global Cache shall subscribe to notifications about the availability of discovery metadata records and core data for real-time or near-real-time exchange. Duplicate notifications are discarded.</p>
</div>
</div>
<div class="sect5">
<h6 id="_requirements_22"><a class="anchor" href="#_requirements_22"></a>Requirements</h6>
<div class="ulist">
<ul>
<li>
<p>Dev/test GB MQTT broker connection string</p>
<div class="ulist">
<ul>
<li>
<p>MQTT user is able to read and write messages on the <code>origin/a/wis2/<mark></code> and <code>cache/a/wis2/</mark></code> topics.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Dev/test GC is initiated with subscription to the <code>cache/a/wis2/<mark></code> topic and <code>origin/a/wis2/</mark></code> topic of the dev/test GB.</p>
</li>
<li>
<p>MQTT test client</p>
<div class="ulist">
<ul>
<li>
<p>Client should connect to the dev/test GB MQTT broker using the provided connection string to control the input and monitor the output.</p>
</li>
</ul>
</div>
</li>
<li>
<p>GC metrics scraper</p>
</li>
<li>
<p>Prepared WIS2 Notification Messages and data objects</p>
<div class="ulist">
<ul>
<li>
<p>A known number <strong><a href="https://github.com/wmo-im/wis2-notification-message">valid</a></strong> WNM&#8217;s where:</p>
<div class="ulist">
<ul>
<li>
<p><code>properties.data_id</code> + <code>properties.pubtime</code> are <mark>NOT</mark> unique to each message, but shared by 2 or more messages.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Accompanying data objects that are accessible via the canonical link provided in the WNM,</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_steps_22"><a class="anchor" href="#_steps_22"></a>Steps</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Publish the prepared WNM&#8217;s to the dev/test GB on one or more of the following topics:</p>
<div class="ulist">
<ul>
<li>
<p>origin/a/wis2/+/data/#</p>
</li>
<li>
<p>cache/a/wis2/+/data/#</p>
</li>
<li>
<p>origin/a/wis2/+/metadata/#</p>
</li>
<li>
<p>cache/a/wis2/+/metadata/#</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="_evaluate_22"><a class="anchor" href="#_evaluate_22"></a>Evaluate</h6>
<div class="ulist">
<ul>
<li>
<p>WNM Messages</p>
<div class="ulist">
<ul>
<li>
<p>Only one message should be published by the GC on the <code>cache/a/wis2/#</code> topic per unique identifier which is defined as <code>properties.data_id</code> + <code>properties.pubtime</code>.</p>
<div class="ulist">
<ul>
<li>
<p>Note that due to the update directive related to 8.2, prepared messages should use unique data_id&#8217;s to ensure uniqueness.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Data Objects</p>
<div class="ulist">
<ul>
<li>
<p>Only one data object should be cached per unique identifier which is defined as <code>properties.data_id</code> + <code>properties.pubtime</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>GC Metrics</p>
<div class="ulist">
<ul>
<li>
<p><code>wmo_wis2_gc_download_total</code> (+=1 for each unique identifier)</p>
</li>
<li>
<p><code>wmo_wis2_gc_dataserver_status_flag</code> (set to 1 for each unique identifier)</p>
</li>
<li>
<p><code>wmo_wis2_gc_dataserver_last_download_timestamp_seconds</code> (set to current for each unique identifier)</p>
</li>
<li>
<p><code>wmo_wis2_gc_downloaded_errors_total</code> (unchanged)</p>
</li>
<li>
<p><code>wmo_wis2_gc_integrity_failed_total</code> (unchanged)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_8_1_wis2_notification_message_deduplication_alternative_1"><a class="anchor" href="#_8_1_wis2_notification_message_deduplication_alternative_1"></a>7.2.1.9. 8.1. WIS2 Notification Message Deduplication (Alternative 1)</h5>
<div class="sect5">
<h6 id="_purpose_23"><a class="anchor" href="#_purpose_23"></a>Purpose</h6>
<div class="paragraph">
<p>Where a Global Cache fails to process a notification message relating to a given unique data object (<code>properties.data_id</code> + <code>properties.pubtime</code>), a Global Cache should successfully process a valid, subsequently received notification message with the same unique data identifier.</p>
</div>
<div class="paragraph">
<p><strong>Source:</strong> Manual on WIS (WMO No. 1060), Vol II, clause 3.7.5.3: A Global Cache shall subscribe to notifications about the availability of discovery metadata records and core data for real-time or near-real-time exchange. Duplicate notifications are discarded.</p>
</div>
</div>
<div class="sect5">
<h6 id="_requirements_23"><a class="anchor" href="#_requirements_23"></a>Requirements</h6>
<div class="ulist">
<ul>
<li>
<p>Dev/test GB MQTT broker connection string</p>
<div class="ulist">
<ul>
<li>
<p>MQTT user is able to read and write messages on the <code>origin/a/wis2/<mark></code> and <code>cache/a/wis2/</mark></code> topics.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Dev/test GC is initiated with subscription to the <code>cache/a/wis2/<mark></code> topic and <code>origin/a/wis2/</mark></code> topic of the dev/test GB.</p>
</li>
<li>
<p>MQTT test client</p>
<div class="ulist">
<ul>
<li>
<p>Client should connect to the dev/test GB MQTT broker using the provided connection string to control the input and monitor the output.</p>
</li>
</ul>
</div>
</li>
<li>
<p>GC metrics scraper</p>
</li>
<li>
<p>Prepared WIS2 Notification Messages and data objects</p>
<div class="ulist">
<ul>
<li>
<p>A known number <strong><a href="https://github.com/wmo-im/wis2-notification-message">valid</a></strong> WNM&#8217;s where:</p>
<div class="ulist">
<ul>
<li>
<p><code>properties.data_id</code> + <code>properties.pubtime</code> are <mark>NOT</mark> unique to each message, but shared by 2 or more messages.</p>
</li>
<li>
<p>This defines a unique identifier message set.</p>
</li>
<li>
<p>For each unique identifier message set, the first published message should be invalid, or the data object inaccessible, and the second message/data object should be valid.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Accompanying data objects that are accessible (or not) via the canonical link provided in the WNM.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_steps_23"><a class="anchor" href="#_steps_23"></a>Steps</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Publish the prepared WNM&#8217;s to the dev/test GB such that the invalid WNM for each unique data identifier is published first. One or more of the following topics can be used:</p>
<div class="ulist">
<ul>
<li>
<p>origin/a/wis2/+/data/#</p>
</li>
<li>
<p>cache/a/wis2/+/data/#</p>
</li>
<li>
<p>origin/a/wis2/+/metadata/#</p>
</li>
<li>
<p>cache/a/wis2/+/metadata/#</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="_evaluate_23"><a class="anchor" href="#_evaluate_23"></a>Evaluate</h6>
<div class="ulist">
<ul>
<li>
<p>WNM Messages</p>
<div class="ulist">
<ul>
<li>
<p>Only one message should be received on the <code>cache/a/wis2/#</code> topic per unique identifier which is defined as <code>properties.data_id</code> + <code>properties.pubtime</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Data Objects</p>
<div class="ulist">
<ul>
<li>
<p>Only one data object should be cached per unique identifier which is defined as <code>properties.data_id</code> + <code>properties.pubtime</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>GC Metrics</p>
<div class="ulist">
<ul>
<li>
<p><code>wmo_wis2_gc_download_total</code> (+=1 for each unique identifier)</p>
</li>
<li>
<p><code>wmo_wis2_gc_dataserver_status_flag</code> (set to 1 for each unique identifier)</p>
</li>
<li>
<p><code>wmo_wis2_gc_dataserver_last_download_timestamp_seconds</code> (set to current for each unique identifier)</p>
</li>
<li>
<p><code>wmo_wis2_gc_downloaded_errors_total</code> (+=1 for each unique identifier WNM message set)</p>
</li>
<li>
<p><code>wmo_wis2_gc_integrity_failed_total</code> (unchanged)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_8_2_wis2_notification_message_deduplication_alternative_2"><a class="anchor" href="#_8_2_wis2_notification_message_deduplication_alternative_2"></a>7.2.1.10. 8.2. WIS2 Notification Message Deduplication (Alternative 2)</h5>
<div class="sect5">
<h6 id="_purpose_24"><a class="anchor" href="#_purpose_24"></a>Purpose</h6>
<div class="paragraph">
<p>Related to the two previous tests, a GC should not process and cache a data item if it has already processed and cached a data item with the same <code>properties.data_id</code> and a <code>properties.pubtime</code> that is equal to or less than the <code>properties.pubtime</code> of the new data item. This test is an extension of the previous tests and can be conducted in conjunction with them.</p>
</div>
</div>
<div class="sect5">
<h6 id="_requirements_24"><a class="anchor" href="#_requirements_24"></a>Requirements</h6>
<div class="paragraph">
<p>See above.</p>
</div>
</div>
<div class="sect5">
<h6 id="_steps_24"><a class="anchor" href="#_steps_24"></a>Steps</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Publish the prepared WNM&#8217;s to the dev/test GB such for each unique identifier message set, the first published message has a pubtime that is <mark>greater than or equal to</mark> the subsequent message/s. One or more of the following topics can be used:</p>
<div class="ulist">
<ul>
<li>
<p>origin/a/wis2/+/data/#</p>
</li>
<li>
<p>cache/a/wis2/+/data/#</p>
</li>
<li>
<p>origin/a/wis2/+/metadata/#</p>
</li>
<li>
<p>cache/a/wis2/+/metadata/#</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="_evaluate_24"><a class="anchor" href="#_evaluate_24"></a>Evaluate</h6>
<div class="ulist">
<ul>
<li>
<p>WNM Messages</p>
<div class="ulist">
<ul>
<li>
<p>For each message set with a shared data_id, each message should be processed by the GC and received on the <code>cache/a/wis2/#</code> topic assuming that the <code>properties.pubtime</code> as been correctly set (decreasing or equal) for each message sent in chronological order.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Data Objects</p>
<div class="ulist">
<ul>
<li>
<p>For each message set with a shared data_id, each data object should be cached by the GC and assuming that the <code>properties.pubtime</code> as been correctly set (decreasing or equal) for each message sent in chronological order.</p>
</li>
</ul>
</div>
</li>
<li>
<p>GC Metrics</p>
<div class="ulist">
<ul>
<li>
<p><code>wmo_wis2_gc_download_total</code> (+=1 for each set of messages sharing the same data_id)</p>
</li>
<li>
<p><code>wmo_wis2_gc_dataserver_status_flag</code> (set to 1)</p>
</li>
<li>
<p><code>wmo_wis2_gc_dataserver_last_download_timestamp_seconds</code> (set to current)</p>
</li>
<li>
<p><code>wmo_wis2_gc_downloaded_errors_total</code> (unchanged)</p>
</li>
<li>
<p><code>wmo_wis2_gc_integrity_failed_total</code> (unchanged)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_9_data_update"><a class="anchor" href="#_9_data_update"></a>7.2.1.11. 9. Data Update</h5>
<div class="sect5">
<h6 id="_purpose_25"><a class="anchor" href="#_purpose_25"></a>Purpose</h6>
<div class="paragraph">
<p>A Global Cache should treat notification messages with the same data item identifier (<code>properties.data_id</code>), but different publication times (<code>properties.pubtime</code>) as unique data items. Data items with the same <code>properties.data_id</code> but a greater/later publication time AND a <mark>update</mark> link (links['rel']='update'), should be processed (see test Notification processing). Data items with the same <code>properties.data_id</code> but earlier or identical publication times should be ignored (see deduplication test 8).</p>
</div>
<div class="paragraph">
<p><strong>Source:</strong> Guide to WIS (WMO No. 1061), Vol II, clause 2.7.4.2. [Global Cache] Practices and procedures: “Verify if the message points to new or updated data by comparing the pubtime value of the notification message with the list of data_ids”. <a href="https://wmo-im.github.io/wis2-guide/guide/wis2-guide-DRAFT.html#_practices_and_procedures_2" class="bare">https://wmo-im.github.io/wis2-guide/guide/wis2-guide-DRAFT.html#_practices_and_procedures_2</a></p>
</div>
</div>
<div class="sect5">
<h6 id="_requirements_25"><a class="anchor" href="#_requirements_25"></a>Requirements</h6>
<div class="ulist">
<ul>
<li>
<p>Dev/test GB MQTT broker connection string</p>
<div class="ulist">
<ul>
<li>
<p>MQTT user is able to read and write messages on the <code>origin/a/wis2/<mark></code> and <code>cache/a/wis2/</mark></code> topics.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Dev/test GC is initiated with subscription to the <code>cache/a/wis2/<mark></code> topic and <code>origin/a/wis2/</mark></code> topic of the dev/test GB.</p>
</li>
<li>
<p>MQTT test client</p>
<div class="ulist">
<ul>
<li>
<p>Client should connect to the dev/test GB MQTT broker using the provided connection string to control the input and monitor the output.</p>
</li>
</ul>
</div>
</li>
<li>
<p>GC metrics scraper</p>
</li>
<li>
<p>Prepared WIS2 Notification Messages and data objects</p>
<div class="ulist">
<ul>
<li>
<p>A known number <strong><a href="https://github.com/wmo-im/wis2-notification-message">valid</a></strong> WNM&#8217;s where:</p>
<div class="ulist">
<ul>
<li>
<p><code>properties.data_id</code> + <code>properties.pubtime</code> are unique to each message, but the properties.data_id is shared by 2 or more messages and the pubtimes are different.</p>
</li>
<li>
<p>Ensure that for a given shared data_id, the message with the latest pubtime has link with <code>rel=update</code>.</p>
</li>
<li>
<p>This defines a unique identifier message set.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Accompanying data objects that are accessible via the canonical link provided in the WNM.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_steps_25"><a class="anchor" href="#_steps_25"></a>Steps</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Publish the prepared WNM&#8217;s to the dev/test GB such for each unique identifier message set, the first published message has a pubtime that is less than the subsequent message/s and subsequent messages have a valid update link. One or more of the following topics can be used:</p>
<div class="ulist">
<ul>
<li>
<p>origin/a/wis2/+/data/#</p>
</li>
<li>
<p>cache/a/wis2/+/data/#</p>
</li>
<li>
<p>origin/a/wis2/+/metadata/#</p>
</li>
<li>
<p>cache/a/wis2/+/metadata/#</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="_evaluate_25"><a class="anchor" href="#_evaluate_25"></a>Evaluate</h6>
<div class="ulist">
<ul>
<li>
<p>WNM Messages</p>
<div class="ulist">
<ul>
<li>
<p>For each message set with a shared data_id, each message should be processed by the GC and received on the <code>cache/a/wis2/#</code> topic assuming that the <code>properties.pubtime</code> as been correctly set (increasing) for each message sent in chronological order.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Data Objects</p>
<div class="ulist">
<ul>
<li>
<p>For each message set with a shared data_id, each data object should be cached by the GC and assuming that the <code>properties.pubtime</code> as been correctly set (increasing) for each message sent in chronological order.</p>
</li>
</ul>
</div>
</li>
<li>
<p>GC Metrics</p>
<div class="ulist">
<ul>
<li>
<p><code>wmo_wis2_gc_download_total</code> (+=1 for each message)</p>
</li>
<li>
<p><code>wmo_wis2_gc_dataserver_status_flag</code> (set to 1)</p>
</li>
<li>
<p><code>wmo_wis2_gc_dataserver_last_download_timestamp_seconds</code> (set to current)</p>
</li>
<li>
<p><code>wmo_wis2_gc_downloaded_errors_total</code> (unchanged)</p>
</li>
<li>
<p><code>wmo_wis2_gc_integrity_failed_total</code> (unchanged)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_performance_tests"><a class="anchor" href="#_performance_tests"></a>7.2.2. Performance tests</h4>
<div class="sect4">
<h5 id="_wis2_notification_processing_rate"><a class="anchor" href="#_wis2_notification_processing_rate"></a>7.2.2.1. WIS2 Notification Processing Rate</h5>
<div class="sect5">
<h6 id="_purpose_26"><a class="anchor" href="#_purpose_26"></a>Purpose</h6>
<div class="paragraph">
<p>A Global Cache shall be able to successfully process, on average, 2000 unique WNM&#8217;s per minute with an average message size of 75kb. This test represents the upper end of the current WNM volume. This test is a measured performance test similar to test 3. WNM Processing except that a large batch of messages is used, and the time taken to process the messages is measured. The noted WNM&#8217;s/minute rate can be used as a performance indicator for the GC being tested.</p>
</div>
</div>
<div class="sect5">
<h6 id="_requirements_26"><a class="anchor" href="#_requirements_26"></a>Requirements</h6>
<div class="ulist">
<ul>
<li>
<p>Dev/test GB MQTT broker connection string</p>
<div class="ulist">
<ul>
<li>
<p>MQTT user is able to read and write messages on the <code>origin/a/wis2/<mark></code> and <code>cache/a/wis2/</mark></code> topics.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Dev/test GC is initiated and connected to the dev/test GB with subscriptions to the following topics:</p>
<div class="ulist">
<ul>
<li>
<p>origin/a/wis2/+/data/#</p>
</li>
<li>
<p>cache/a/wis2/+/data/#</p>
</li>
<li>
<p>origin/a/wis2/+/metadata/#</p>
</li>
<li>
<p>cache/a/wis2/+/metadata/#</p>
</li>
</ul>
</div>
</li>
<li>
<p>MQTT test client</p>
<div class="ulist">
<ul>
<li>
<p>Client should connect to the dev/test GB MQTT broker using the provided connection string to control the input and monitor the output.</p>
</li>
</ul>
</div>
</li>
<li>
<p>GC metrics scraper</p>
</li>
<li>
<p>Prepared WIS2 Notification Messages and associated data objects:</p>
<div class="ulist">
<ul>
<li>
<p>A known number <strong><a href="https://github.com/wmo-im/wis2-notification-message">valid</a></strong> WNM&#8217;s with:</p>
<div class="ulist">
<ul>
<li>
<p><code>properties.cache</code> set to true</p>
</li>
<li>
<p><code>properties.data_id</code> + <code>properties.pubtime</code> should be unique to each message. The ensure consistency, data_id alone should be used to determine uniqueness.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Accompanying data objects should be accessible via the canonical link provided in the WNM.</p>
<div class="ulist">
<ul>
<li>
<p>The canonical link should be accessible per the core requirements and the data object hash should match the hash provided in the WNM if integrity properties are provided.</p>
</li>
<li>
<p>Average message size should be 75kb.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_steps_26"><a class="anchor" href="#_steps_26"></a>Steps</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start the timer, and publish the batch of 2000 prepared WNM&#8217;s to the dev/test GB on following topics:</p>
<div class="ulist">
<ul>
<li>
<p>origin/a/wis2/+/data/#</p>
</li>
<li>
<p>cache/a/wis2/+/data/#</p>
</li>
<li>
<p>origin/a/wis2/+/metadata/#</p>
</li>
<li>
<p>cache/a/wis2/+/metadata/#</p>
</li>
</ul>
</div>
</li>
<li>
<p>The test MQTT client should count the messages received on the <code>cache/a/wis2/#</code> topic that are published by the GC, but should not download the data objects.</p>
</li>
<li>
<p>Stop the timer when the MQTT client has received all expected messages (2000). A timeout can be set to allow the test to run as long as needed within a reasonable window.</p>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="_evaluate_26"><a class="anchor" href="#_evaluate_26"></a>Evaluate</h6>
<div class="ulist">
<ul>
<li>
<p>WNM Messages</p>
<div class="ulist">
<ul>
<li>
<p>The total number of cache notification messages published by the GC on the cache/a/wis2/# topic should match what was published (2000).</p>
</li>
</ul>
</div>
</li>
<li>
<p>GC Metrics</p>
<div class="ulist">
<ul>
<li>
<p><code>wmo_wis2_gc_download_total</code> matches total expected messages.</p>
</li>
</ul>
</div>
</li>
<li>
<p>The time taken to process the messages should not exceed 60 seconds (plus time taken to publish the WNM&#8217;s) in order to pass the test.</p>
<div class="ulist">
<ul>
<li>
<p>The results can be used as a baseline for the GC&#8217;s performance.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_concurrent_client_downloads"><a class="anchor" href="#_concurrent_client_downloads"></a>7.2.2.2. Concurrent client downloads</h5>
<div class="sect5">
<h6 id="_purpose_27"><a class="anchor" href="#_purpose_27"></a>Purpose</h6>
<div class="paragraph">
<p>A Global Cache should support a minimum of 1000 simultaneous downloads.</p>
</div>
<div class="paragraph">
<p><strong>Source:</strong> Manual on WIS (WMO No. 1060), Vol II, clause 3.7.5.5: A Global Cache shall provide highly available access to copies of discovery metadata records and core data it stores; clause 4.5.1: A Global Cache shall operate a highly available storage and download service; clause 4.5.2: A Global Cache shall download core data and discovery metadata from [WIS2 Nodes] and other Global [Services] to provide for reliable, low-latency access to those resources via WIS.
<strong>Source:</strong> Guide to WIS (WMO No. 1061), Vol II, clause 2.7.2.2. Service levels, performance indicators and fair-usage policies: <a href="https://wmo-im.github.io/wis2-guide/guide/wis2-guide-DRAFT.html#_procedure_for_registration_of_a_new_global_service" class="bare">https://wmo-im.github.io/wis2-guide/guide/wis2-guide-DRAFT.html#_procedure_for_registration_of_a_new_global_service</a></p>
</div>
</div>
<div class="sect5">
<h6 id="_requirements_27"><a class="anchor" href="#_requirements_27"></a>Requirements</h6>
<div class="ulist">
<ul>
<li>
<p>Dev/test GB MQTT broker connection string</p>
<div class="ulist">
<ul>
<li>
<p>MQTT user is able to read and write messages on the <code>origin/a/wis2/<mark></code> and <code>cache/a/wis2/</mark></code> topics.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Dev/test GC is initiated and connected to the dev/test GB with subscriptions to the following topics:</p>
<div class="ulist">
<ul>
<li>
<p>origin/a/wis2/+/data/#</p>
</li>
<li>
<p>cache/a/wis2/+/data/#</p>
</li>
<li>
<p>origin/a/wis2/+/metadata/#</p>
</li>
<li>
<p>cache/a/wis2/+/metadata/#</p>
</li>
</ul>
</div>
</li>
<li>
<p>MQTT test client</p>
<div class="ulist">
<ul>
<li>
<p>Client should connect to the dev/test GB MQTT broker using the provided connection string to control the input and monitor the output.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Prepared WIS2 Notification Messages and associated data objects:</p>
<div class="ulist">
<ul>
<li>
<p>A known number (5) <strong><a href="https://github.com/wmo-im/wis2-notification-message">valid</a></strong> WNM&#8217;s with:</p>
<div class="ulist">
<ul>
<li>
<p><code>properties.cache</code> set to true</p>
</li>
<li>
<p><code>properties.data_id</code> + <code>properties.pubtime</code> should be unique to each message. Ensuring a different data_id is best here.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Valid data objects to be cached</p>
<div class="ulist">
<ul>
<li>
<p>A larger than average data object should be generated/used in order to ensure that the clients downloading the data object concurrently do not finish before the test is complete. A 500MB data object is recommended.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Jmeter, Locust, or similar tool to manage the concurrent downloads.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_steps_27"><a class="anchor" href="#_steps_27"></a>Steps</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Publish the prepared WNM&#8217;s one at a time to the dev/test GB on one of the following topics:</p>
<div class="ulist">
<ul>
<li>
<p>origin/a/wis2/+/data/#</p>
</li>
<li>
<p>cache/a/wis2/+/data/#</p>
</li>
<li>
<p>origin/a/wis2/+/metadata/#</p>
</li>
<li>
<p>cache/a/wis2/+/metadata/#</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>For each WNM:
. Once the <em>cache</em> notification message is received by the test MQTT client (from the dev/test GC), the test client should start 1000 concurrent downloads of the data object/s from the canonical link provided in the <em>cache</em> WNM.
. The test client should record the number of successful downloads and the time taken to complete each download.</p>
</div>
</div>
<div class="sect5">
<h6 id="_evaluate_27"><a class="anchor" href="#_evaluate_27"></a>Evaluate</h6>
<div class="paragraph">
<p>The test is considered successful if the following conditions are met:
* The total number of successful downloads is 1000.
* While the download time can be used to establish a baseline, it is highly dependent on the network and server conditions of the test environment and should not be used as a pass/fail criteria.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_implicit_tests"><a class="anchor" href="#_implicit_tests"></a>7.2.3. Implicit tests</h4>
<div class="paragraph">
<p>These are tests that are to be verified by the individual implementations as they represent critical requirements but would be difficult to test in a generic way.</p>
</div>
<div class="sect4">
<h5 id="_valid_tlsssl_certificate"><a class="anchor" href="#_valid_tlsssl_certificate"></a>7.2.3.1. Valid TLS/SSL certificate</h5>
<div class="ulist">
<ul>
<li>
<p>A Global Cache must have a valid TLS/SSL certificate to ensure secure communication with other WIS2 components.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_available_storage_space"><a class="anchor" href="#_available_storage_space"></a>7.2.3.2. Available Storage Space</h5>
<div class="ulist">
<ul>
<li>
<p>A Global Cache shall be able to store at least 100GB of Core data items.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Source:</strong> Guide to WIS (WMO No. 1061), Vol II, clause 2.7.2.2. Service levels, performance indicators and fair-usage policies: “A Global Cache should support a minimum of 100 GB of data in the cache” <a href="https://wmo-im.github.io/wis2-guide/guide/wis2-guide-DRAFT.html#_procedure_for_registration_of_a_new_global_service" class="bare">https://wmo-im.github.io/wis2-guide/guide/wis2-guide-DRAFT.html#_procedure_for_registration_of_a_new_global_service</a></p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="global-discovery-catalogue-testing"><a class="anchor" href="#global-discovery-catalogue-testing"></a>7.3. Global Discovery Catalogue Service testing</h3>
<div class="sect3">
<h4 id="_test_setup"><a class="anchor" href="#_test_setup"></a>7.3.1. Test setup</h4>
<div class="paragraph">
<p>The GDC test setup consists of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A test data bundle to consist of:</p>
<div class="ulist">
<ul>
<li>
<p>100 valid WCMP2 records</p>
</li>
<li>
<p>1 broken JSON WCMP2 record</p>
</li>
<li>
<p>1 invalid WCMP2 record</p>
</li>
<li>
<p>102 WNM documents, each of which pointing to the related WCMP2 records</p>
</li>
<li>
<p>1 WNM document specifying a WCMP2 record deletion</p>
</li>
</ul>
</div>
</li>
<li>
<p>all WCMP2 records stored on an HTTP server</p>
</li>
<li>
<p>all WNM documents updated to point to the correct HTTP server for proper HTTP dereferencing</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_functional_tests_3"><a class="anchor" href="#_functional_tests_3"></a>7.3.2. Functional tests</h4>
<div class="sect4">
<h5 id="_global_broker_connection_and_subscription"><a class="anchor" href="#_global_broker_connection_and_subscription"></a>7.3.2.1. Global Broker connection and subscription</h5>
<div class="sect5">
<h6 id="_purpose_28"><a class="anchor" href="#_purpose_28"></a>Purpose</h6>
<div class="paragraph">
<p>A Global Discovery Catalogue must connect to a Global Broker using the MQTT protocol with TLS and username/password authentication (everyone/everyone) and subscribe to the following topic:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>cache/a/wis2/+/metadata/#</code></p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_steps_28"><a class="anchor" href="#_steps_28"></a>Steps</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Initialize the MQTT client with the necessary parameters such as the MQTT protocol version 5, TLS security, and username/password for authentication.</p>
</li>
<li>
<p>Connect the MQTT client to the Global Broker.</p>
</li>
<li>
<p>Once the connection is successful, attempt to subscribe to the following topics:</p>
<div class="ulist">
<ul>
<li>
<p><code>cache/a/wis2/+/metadata/#</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Check if the subscription is successful. If the subscription is successful, proceed. If the subscription is not successful, the test fails.</p>
</li>
<li>
<p>Close the connections to the broker after the test.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>On successful completion, the following metrics should be modified:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>wmo_wis2_gdc_connected_flag</code> for the centre-id from which the Global Discovery Catalogue connected to should be set to 1 (one).</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_notification_and_metadata_processing_success"><a class="anchor" href="#_notification_and_metadata_processing_success"></a>7.3.2.2. Notification and metadata processing (success)</h5>
<div class="sect5">
<h6 id="_purpose_29"><a class="anchor" href="#_purpose_29"></a>Purpose</h6>
<div class="paragraph">
<p>The Global Discovery Catalogue should be able to process valid WCMP2 metadata record of core data published by a WIS2 Node.</p>
</div>
</div>
<div class="sect5">
<h6 id="_steps_29"><a class="anchor" href="#_steps_29"></a>Steps</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Initialize the MQTT client with the necessary parameters such as the MQTT protocol version 5, TLS security, and username/password for authentication.</p>
</li>
<li>
<p>Connect the MQTT client to the Global Broker.</p>
</li>
<li>
<p>Once the connection is successful, attempt to subscribe to the following topics:</p>
<div class="ulist">
<ul>
<li>
<p><code>cache/a/wis2/+/metadata/#</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Check if the subscription is successful. If the subscription is successful, proceed. If the subscription is not successful, the test fails.</p>
</li>
<li>
<p>On an incoming message:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>find the canonical link object in the <code>links</code> array.</p>
</li>
<li>
<p>from the matching link, issue a HTTP GET request against the matching <code>href</code> value.</p>
</li>
<li>
<p>parse the HTTP response:</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>validate against the WCMP2 Executable Test Suite (ETS)</p>
</li>
<li>
<p>publish the WCMP2 record to the catalogue</p>
</li>
<li>
<p>publish an ETS validation report as a notification message to the GDC MQTT broker.</p>
</li>
</ol>
</div>
</li>
<li>
<p>using the WCMP2 identifier (i.e. <code>$WCMP2_ID</code>), construct a path to the record on the GDC (<code>https://HOST/collections/wis2-discovery-metadata/$WCMP2_ID</code>).</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>On successful completion:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the resulting WCMP2 record should be available on the GDC API and contain an MQTT link / channel (using <code>cache/a/wis2</code>) foreach Global Broker</p>
</li>
<li>
<p>the following metrics should be modified:</p>
<div class="ulist">
<ul>
<li>
<p><code>wmo_wis2_gdc_passed_total</code> for the centre-id from where the metadata was published from should be incremented by 1 (one).</p>
</li>
<li>
<p><code>wmo_wis2_gdc_core_total</code> for the centre-id from where the metadata (core data policy) was published from should be incremented by 1 (one).</p>
</li>
</ul>
</div>
</li>
<li>
<p>a notification message should arrive from the Global Broker under <code>monitor/a/wis2/CENTRE_ID_global-discovery-catalogue/centre-id</code>)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_notification_and_metadata_processing_failure_record_not_found"><a class="anchor" href="#_notification_and_metadata_processing_failure_record_not_found"></a>7.3.2.3. Notification and metadata processing (failure; record not found)</h5>
<div class="sect5">
<h6 id="_purpose_30"><a class="anchor" href="#_purpose_30"></a>Purpose</h6>
<div class="paragraph">
<p>The Global Discovery Catalogue should be able to process failing (record not found) WCMP2 metadata published by a WIS2 Node.</p>
</div>
</div>
<div class="sect5">
<h6 id="_steps_30"><a class="anchor" href="#_steps_30"></a>Steps</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Initialize the MQTT client with the necessary parameters such as the MQTT protocol version 5, TLS security, and username/password for authentication.</p>
</li>
<li>
<p>Connect the MQTT client to the Global Broker.</p>
</li>
<li>
<p>Once the connection is successful, attempt to subscribe to the following topics:</p>
<div class="ulist">
<ul>
<li>
<p><code>cache/a/wis2/+/metadata/#</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Check if the subscription is successful. If the subscription is successful, proceed. If the subscription is not successful, the test fails.</p>
</li>
<li>
<p>On an incoming message:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>find the canonical link object in the <code>links</code> array.</p>
</li>
<li>
<p>from the matching link, issue a HTTP GET request against the matching <code>href</code> value.</p>
</li>
<li>
<p>if the response is an HTTP status code of 404:</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>publish an ETS error report as a notification message to the GDC MQTT broker.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>On successful completion:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the following metrics should be modified:</p>
<div class="ulist">
<ul>
<li>
<p><code>wmo_wis2_gdc_failed_total</code> for the centre-id from where the metadata was published from should be incremented by 1 (one).</p>
</li>
</ul>
</div>
</li>
<li>
<p>a notification message should arrive from the Global Broker under <code>monitor/a/wis2/CENTRE_ID_global-discovery-catalogue/centre-id</code>)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_notification_and_metadata_processing_failure_malformed_json_or_invalid_wcmp2"><a class="anchor" href="#_notification_and_metadata_processing_failure_malformed_json_or_invalid_wcmp2"></a>7.3.2.4. Notification and metadata processing (failure; malformed JSON or invalid WCMP2)</h5>
<div class="sect5">
<h6 id="_purpose_31"><a class="anchor" href="#_purpose_31"></a>Purpose</h6>
<div class="paragraph">
<p>The Global Discovery Catalogue should be able to process failing (malformed JSON) WCMP2 metadata published by a WIS2 Node.</p>
</div>
</div>
<div class="sect5">
<h6 id="_steps_31"><a class="anchor" href="#_steps_31"></a>Steps</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Initialize the MQTT client with the necessary parameters such as the MQTT protocol version 5, TLS security, and username/password for authentication.</p>
</li>
<li>
<p>Connect the MQTT client to the Global Broker.</p>
</li>
<li>
<p>Once the connection is successful, attempt to subscribe to the following topics:</p>
<div class="ulist">
<ul>
<li>
<p><code>cache/a/wis2/+/metadata/#</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Check if the subscription is successful. If the subscription is successful, proceed. If the subscription is not successful, the test fails.</p>
</li>
<li>
<p>On an incoming message:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>find the canonical link object in the <code>links</code> array.</p>
</li>
<li>
<p>from the matching link, issue a HTTP GET request against the matching <code>href</code> value.</p>
</li>
<li>
<p>parse the HTTP response:</p>
</li>
<li>
<p>if the JSON is malformed, or the WCMP2 is invalid:</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>publish an ETS error report as a notification message to the GDC MQTT broker.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>On successful completion:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the following metrics should be modified:</p>
<div class="ulist">
<ul>
<li>
<p><code>wmo_wis2_gdc_failed_total</code> for the centre-id from where the metadata was published from should be incremented by 1 (one).</p>
</li>
</ul>
</div>
</li>
<li>
<p>a notification message should arrive from the Global Broker under <code>monitor/a/wis2/CENTRE_ID_global-discovery-catalogue/centre-id</code>)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_metadata_ingest_centre_id_mismatch"><a class="anchor" href="#_metadata_ingest_centre_id_mismatch"></a>7.3.2.5. Metadata ingest centre-id mismatch</h5>
<div class="sect5">
<h6 id="_purpose_32"><a class="anchor" href="#_purpose_32"></a>Purpose</h6>
<div class="paragraph">
<p>A Global Discovery Catalogue should detect a mismatch between an incoming message topic&#8217;s centre-id and the centre-id as part of a WCMP2 record identifier.</p>
</div>
</div>
<div class="sect5">
<h6 id="_steps_32"><a class="anchor" href="#_steps_32"></a>Steps</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Initialize the MQTT client with the necessary parameters such as the MQTT protocol version 5, TLS security, and username/password for authentication.</p>
</li>
<li>
<p>Connect the MQTT client to the Global Broker.</p>
</li>
<li>
<p>Once the connection is successful, attempt to subscribe to the following topics:</p>
<div class="ulist">
<ul>
<li>
<p><code>cache/a/wis2/+/metadata/#</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Check if the subscription is successful. If the subscription is successful, proceed. If the subscription is not successful, the test fails.</p>
</li>
<li>
<p>On an incoming message:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>capture the centre-id from the topic (4th token split on <code>/</code>).</p>
</li>
<li>
<p>find the canonical link object in the <code>links</code> array.</p>
</li>
<li>
<p>from the matching link, issue a HTTP GET request against the matching <code>href</code> value.</p>
</li>
<li>
<p>parse the HTTP response:</p>
</li>
<li>
<p>extract the centre-id from WCMP2 record identifier (<code>id</code> property, 3rd token split on <code>:</code>).</p>
</li>
<li>
<p>in the WCMP2 record, if a MQTT link exists (<code>rel=items</code>, <code>channel</code> starts with <code>origin/a/wis2</code>), capture the centre-id from the topic (4th token split on <code>/</code>).</p>
</li>
</ol>
</div>
</li>
<li>
<p>compare the following values to verify that they are identical:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>centre-id extracted from topic</p>
</li>
<li>
<p>centre-id extracted from WCMP2 identifier</p>
</li>
<li>
<p>centre-id extracted from MQTT link in WCMP2 record</p>
</li>
</ol>
</div>
</li>
<li>
<p>publish an ETS error report as a notification message to the GDC MQTT broker.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>On successful completion, the following metrics should be modified:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>wmo_wis2_gdc_failed_total</code> for the centre-id from where the metadata was published from should be incremented by 1 (one).</p>
</li>
<li>
<p>a notification message should arrive from the Global Broker under <code>monitor/a/wis2/CENTRE_ID_global-discovery-catalogue/centre-id</code>)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_notification_and_metadata_processing_record_deletion"><a class="anchor" href="#_notification_and_metadata_processing_record_deletion"></a>7.3.2.6. Notification and metadata processing (record deletion)</h5>
<div class="sect5">
<h6 id="_purpose_33"><a class="anchor" href="#_purpose_33"></a>Purpose</h6>
<div class="paragraph">
<p>The Global Discovery Catalogue should be able to process valid WCMP2 metadata record deletion of core data published by a WIS2 Node.</p>
</div>
</div>
<div class="sect5">
<h6 id="_steps_33"><a class="anchor" href="#_steps_33"></a>Steps</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Initialize the MQTT client with the necessary parameters such as the MQTT protocol version 5, TLS security, and username/password for authentication.</p>
</li>
<li>
<p>Connect the MQTT client to the Global Broker.</p>
</li>
<li>
<p>Once the connection is successful, attempt to subscribe to the following topics:</p>
<div class="ulist">
<ul>
<li>
<p><code>cache/a/wis2/+/metadata/#</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Check if the subscription is successful. If the subscription is successful, proceed. If the subscription is not successful, the test fails.</p>
</li>
<li>
<p>On an incoming message:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>find the link object in the <code>links</code> array where <code>rel=deletion</code>.</p>
</li>
<li>
<p>capture the <code>properties.metadata_id</code> value</p>
</li>
<li>
<p>from the matching link, issue a HTTP GET request against the matching <code>href</code> value.</p>
</li>
<li>
<p>parse the HTTP response:</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>validate against the WCMP2 Executable Test Suite (ETS)</p>
</li>
<li>
<p>delete the WCMP2 record from the catalogue using the value from <code>properties.metadata_id</code> captured earlier in the test.</p>
</li>
<li>
<p>publish a notification message to the GDC MQTT broker.</p>
</li>
</ol>
</div>
</li>
<li>
<p>using the WCMP2 identifier (i.e. <code>$WCMP2_ID</code>), construct a path to the record on the GDC (<code>https://HOST/collections/wis2-discovery-metadata/$WCMP2_ID</code>).</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>On successful completion:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the WCMP2 record should be removed from the GDC API</p>
</li>
<li>
<p>the following metrics should be modified:</p>
<div class="ulist">
<ul>
<li>
<p><code>wmo_wis2_gdc_passed_total</code> for the centre-id from where the metadata was published from should be decremented by 1 (one).</p>
</li>
<li>
<p><code>wmo_wis2_gdc_core_total</code> for the centre-id from where the metadata (core data policy) was published from should be decremented by 1 (one).</p>
</li>
</ul>
</div>
</li>
<li>
<p>a notification message should arrive from the Global Broker under <code>monitor/a/wis2/CENTRE_ID_global-discovery-catalogue/centre-id</code>)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_notification_and_metadata_processing_failure_record_deletion_message_does_not_contain_properties_metadata_id"><a class="anchor" href="#_notification_and_metadata_processing_failure_record_deletion_message_does_not_contain_properties_metadata_id"></a>7.3.2.7. Notification and metadata processing (failure; record deletion message does not contain <code>properties.metadata_id</code>)</h5>
<div class="sect5">
<h6 id="_purpose_34"><a class="anchor" href="#_purpose_34"></a>Purpose</h6>
<div class="paragraph">
<p>The Global Discovery Catalogue should be able to detect a WNM error when <code>properties.metadata_id</code> is missing from a WCMP2 deletion request.</p>
</div>
</div>
<div class="sect5">
<h6 id="_steps_34"><a class="anchor" href="#_steps_34"></a>Steps</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Initialize the MQTT client with the necessary parameters such as the MQTT protocol version 5, TLS security, and username/password for authentication.</p>
</li>
<li>
<p>Connect the MQTT client to the Global Broker.</p>
</li>
<li>
<p>Once the connection is successful, attempt to subscribe to the following topics:</p>
<div class="ulist">
<ul>
<li>
<p><code>cache/a/wis2/+/metadata/#</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Check if the subscription is successful. If the subscription is successful, proceed. If the subscription is not successful, the test fails.</p>
</li>
<li>
<p>On an incoming message:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>find the link object in the <code>links</code> array where <code>rel=deletion</code>.</p>
</li>
<li>
<p>capture the missing <code>properties.metadata_id</code> value</p>
</li>
<li>
<p>publish a notification message of the error to the GDC MQTT broker.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>On successful completion:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a notification message should arrive from the Global Broker under <code>monitor/a/wis2/CENTRE_ID_global-discovery-catalogue/centre-id</code>)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_wcmp2_metadata_archive_zipfile_publication"><a class="anchor" href="#_wcmp2_metadata_archive_zipfile_publication"></a>7.3.2.8. WCMP2 metadata archive zipfile publication</h5>
<div class="sect5">
<h6 id="_purpose_35"><a class="anchor" href="#_purpose_35"></a>Purpose</h6>
<div class="paragraph">
<p>Validate that a GDC API publishes a metadata archive zipfile.</p>
</div>
</div>
<div class="sect5">
<h6 id="_steps_35"><a class="anchor" href="#_steps_35"></a>Steps</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Construct a path to the GDC endpoint (<code>https://HOST/collections/wis2-discovery-metadata</code>).</p>
</li>
<li>
<p>Issue a HTTP GET request on the path.</p>
</li>
<li>
<p>Parse the HTTP response.</p>
</li>
<li>
<p>Check that the record includes a <code>links</code> array.</p>
</li>
<li>
<p>In the <code>links</code> array, check that a metadata archive zipfile link is available (where a link object&#8217;s <code>rel=archives</code> and <code>type=application/zip</code>).</p>
</li>
<li>
<p>In the matching link, issue a HTTP GET request on the associated <code>href</code> value.</p>
</li>
<li>
<p>Unzip the content of the HTTP response.</p>
</li>
<li>
<p>Initialize the MQTT client with the necessary parameters such as the MQTT protocol version 5, TLS security, and username/password for authentication.</p>
</li>
<li>
<p>Connect the MQTT client to the Global Discovery Catalogue.</p>
</li>
<li>
<p>Once the connection is successful, attempt to subscribe to the following topics:</p>
<div class="ulist">
<ul>
<li>
<p><code>origin/a/wis2/centre-id/metadata/#</code> (where <code>centre-id</code> is the centre identifier of the Global Discovery Catalogue).</p>
</li>
</ul>
</div>
</li>
<li>
<p>Check if the subscription is successful. If the subscription is successful, proceed. If the subscription is not successful, the test fails.</p>
</li>
<li>
<p>If the MQTT client is able to successfully subscribe to the topic on the Global Discovery Catalogue, the test passes. If not, the test fails.</p>
</li>
<li>
<p>On receipt of a notification message, issue a HTTP GET requerst on the canonical link (a link object&#8217;s <code>href</code> property where <code>rel=canonical</code>)</p>
</li>
<li>
<p>Unzip the content of the HTTP response.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>On successful completion:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the resulting HTTP response should be zip encoded data, which, when unzipped, contains a directory of JSON files of WCMP2 metadata.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_wcmp2_cold_start_initialization_from_metadata_archive_zipfile"><a class="anchor" href="#_wcmp2_cold_start_initialization_from_metadata_archive_zipfile"></a>7.3.2.9. WCMP2 cold start initialization from metadata archive zipfile</h5>
<div class="sect5">
<h6 id="_purpose_36"><a class="anchor" href="#_purpose_36"></a>Purpose</h6>
<div class="paragraph">
<p>Validate that a GDC initializes from a metadata archive zipfile.</p>
</div>
</div>
<div class="sect5">
<h6 id="_steps_36"><a class="anchor" href="#_steps_36"></a>Steps</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Construct a path to an existing, functional GDC endpoint (<code>https://HOST/collections/wis2-discovery-metadata</code>).</p>
</li>
<li>
<p>Issue a HTTP GET request on the path.</p>
</li>
<li>
<p>Parse the HTTP response.</p>
</li>
<li>
<p>Check that the record includes a <code>links</code> array.</p>
</li>
<li>
<p>In the <code>links</code> array, check that a metadata archive zipfile link is available (where a link object&#8217;s <code>rel=archives</code> and <code>type=application/zip</code>).</p>
</li>
<li>
<p>In the matching link, issue a HTTP GET request on the associated <code>href</code> value.</p>
</li>
<li>
<p>Unzip the content of the HTTP response.</p>
</li>
<li>
<p>Foreach WCMP2 (JSON) record in the zipfile, validate and ingest into the new GDC</p>
</li>
<li>
<p>Construct a path to a Global Replay service endpoint (<code>https://HOST/collections/wis2-notification-messages?q=%22cache/a/wis2/*/metadata%22&amp;datetime=START_TIME/..</code>).</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><code>START_TIME</code> is a timestamp that is from up to 24 hours ago, in RFC3339 format.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Issue a HTTP GET request on the path.</p>
</li>
<li>
<p>Parse the HTTP response.</p>
</li>
<li>
<p>Foreach item in the <code>features</code> array:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Check that the item includes a <code>links</code> array.</p>
</li>
<li>
<p>In the <code>links</code> array, match the link where <code>rel=canonical</code>.</p>
</li>
<li>
<p>In the matching link, issue a HTTP GET request on the associated <code>href</code> value.</p>
</li>
<li>
<p>Parse the HTTP response.</p>
</li>
<li>
<p>Validate and ingest into the new GDC</p>
</li>
</ol>
</div>
</li>
<li>
<p>Construct a path to the new GDC endpoint (<code>https://HOST/collections/wis2-discovery-metadata/items</code>).</p>
</li>
<li>
<p>Issue a HTTP GET request on the path.</p>
</li>
<li>
<p>Parse the HTTP response.</p>
</li>
<li>
<p>Count the number of items in the <code>numberMatched</code> property.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>On successful completion:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the number of the features in the GDC should match the number of records in the metadata archive zipfile and the number of records from the Global Replay query.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_api_functionality"><a class="anchor" href="#_api_functionality"></a>7.3.2.10. API functionality</h5>
<div class="sect5">
<h6 id="_purpose_37"><a class="anchor" href="#_purpose_37"></a>Purpose</h6>
<div class="paragraph">
<p>Validate that a GDC API performs as expected based on the OGC API - Records standard.</p>
</div>
</div>
<div class="sect5">
<h6 id="_steps_37"><a class="anchor" href="#_steps_37"></a>Steps</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Construct a path to the GDC endpoint (<code>https://HOST/collections/wis2-discovery-metadata</code>).</p>
</li>
<li>
<p>Issue a HTTP GET request on the path.</p>
</li>
<li>
<p>Parse the HTTP response.</p>
</li>
<li>
<p>Check that the record includes a <code>links</code> array.</p>
</li>
<li>
<p>In the <code>links</code> array, check that an items link is available (where a link object&#8217;s <code>rel=items</code> and <code>type=application/geo+json</code>).</p>
</li>
<li>
<p>In the matching link, issue a HTTP GET request on the associated <code>href</code> value.</p>
</li>
<li>
<p>Parse the HTTP response.</p>
</li>
<li>
<p>Ensure that a <code>numberMatched</code> property exists with an integer value of 6.</p>
</li>
<li>
<p>Ensure that a <code>numberReturned</code> property exists with an integer value of 6.</p>
</li>
<li>
<p>Construct a path to the GDC endpoint with a bounding box query parameter (<code>https://HOST/collections/wis2-discovery-metadata/items?bbox=-142,42,-53,84</code>).</p>
</li>
<li>
<p>Issue a HTTP GET request on the path.</p>
</li>
<li>
<p>Parse the HTTP response.</p>
</li>
<li>
<p>Ensure that a <code>numberMatched</code> property exists with an integer value of 2.</p>
</li>
<li>
<p>Ensure that a <code>numberReturned</code> property exists with an integer value of 2.</p>
</li>
<li>
<p>Ensure that a <code>features</code> array exists.</p>
</li>
<li>
<p>Construct a path to the GDC endpoint with a temporal query parameter (<code>https://HOST/collections/wis2-discovery-metadata/items?datetime=2000-11-11T12:42:23Z/..</code>).</p>
</li>
<li>
<p>Issue a HTTP GET request on the path.</p>
</li>
<li>
<p>Parse the HTTP response.</p>
</li>
<li>
<p>Ensure that a <code>numberMatched</code> property exists with an integer value of 6.</p>
</li>
<li>
<p>Ensure that a <code>numberReturned</code> property exists with an integer value of 6.</p>
</li>
<li>
<p>Ensure that a <code>features</code> array exists.</p>
</li>
<li>
<p>Construct a path to the GDC endpoint with a full text query parameter (<code>https://HOST/collections/wis2-discovery-metadata/items?q=observations</code>).</p>
</li>
<li>
<p>Issue a HTTP GET request on the path.</p>
</li>
<li>
<p>Parse the HTTP response.</p>
</li>
<li>
<p>Ensure that a <code>numberMatched</code> property exists with an integer value of 4.</p>
</li>
<li>
<p>Ensure that a <code>numberReturned</code> property exists with an integer value of 4.</p>
</li>
<li>
<p>Ensure that a <code>features</code> array exists.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_performance_tests_2"><a class="anchor" href="#_performance_tests_2"></a>7.3.3. Performance tests</h4>
<div class="sect4">
<h5 id="_processing_timeliness"><a class="anchor" href="#_processing_timeliness"></a>7.3.3.1. Processing timeliness</h5>
<div class="sect5">
<h6 id="_purpose_38"><a class="anchor" href="#_purpose_38"></a>Purpose</h6>
<div class="paragraph">
<p>Validate that a GDC is able to process WCMP2 metadata in a timely manner.</p>
</div>
</div>
<div class="sect5">
<h6 id="_steps_38"><a class="anchor" href="#_steps_38"></a>Steps</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Initialize the MQTT client with the necessary parameters such as the MQTT protocol version 5, TLS security, and username/password for authentication.</p>
</li>
<li>
<p>Connect the MQTT client to the Global Broker.</p>
</li>
<li>
<p>Once the connection is successful, attempt to subscribe to the following topics:</p>
<div class="ulist">
<ul>
<li>
<p><code>cache/a/wis2/+/metadata/#</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Check if the subscription is successful. If the subscription is successful, proceed. If the subscription is not successful, the test fails.</p>
</li>
<li>
<p>On all incoming messages:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>find the canonical link object in the <code>links</code> array.</p>
</li>
<li>
<p>from the matching link, issue a HTTP GET request against the matching <code>href</code> value.</p>
</li>
<li>
<p>parse the HTTP response:</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>validate against the WCMP2 Executable Test Suite (ETS)</p>
</li>
<li>
<p>publish the WCMP2 record to the catalogue</p>
</li>
<li>
<p>publish an ETS validation report as a notification message to the GDC MQTT broker.</p>
</li>
</ol>
</div>
</li>
<li>
<p>using the WCMP2 identifier (i.e. <code>$WCMP2_ID</code>), construct a path to the record on the GDC (<code>https://HOST/collections/wis2-discovery-metadata/$WCMP2_ID</code>).</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>On successful completion:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>all WCMP2 records should be processed and published in 5 minutes</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="results"><a class="anchor" href="#results"></a>8. Results</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="global-cache-results"><a class="anchor" href="#global-cache-results"></a>8.1. Global Cache Service results</h3>
<div class="sect3">
<h4 id="global-cache-china-results"><a class="anchor" href="#global-cache-china-results"></a>8.1.1. China</h4>
<div class="sect4">
<h5 id="_functional_test_results"><a class="anchor" href="#_functional_test_results"></a>8.1.1.1. Functional test results</h5>

</div>
<div class="sect4">
<h5 id="_performance_test_results"><a class="anchor" href="#_performance_test_results"></a>8.1.1.2. Performance test results</h5>

</div>
<div class="sect4">
<h5 id="_testing_observations"><a class="anchor" href="#_testing_observations"></a>8.1.1.3. Testing observations</h5>

</div>
</div>
<div class="sect3">
<h4 id="global-cache-germany-results"><a class="anchor" href="#global-cache-germany-results"></a>8.1.2. Germany</h4>
<div class="sect4">
<h5 id="_functional_test_results_2"><a class="anchor" href="#_functional_test_results_2"></a>8.1.2.1. Functional test results</h5>

</div>
<div class="sect4">
<h5 id="_performance_test_results_2"><a class="anchor" href="#_performance_test_results_2"></a>8.1.2.2. Performance test results</h5>

</div>
<div class="sect4">
<h5 id="_testing_observations_2"><a class="anchor" href="#_testing_observations_2"></a>8.1.2.3. Testing observations</h5>

</div>
</div>
<div class="sect3">
<h4 id="global-cache-japan-results"><a class="anchor" href="#global-cache-japan-results"></a>8.1.3. Japan</h4>
<div class="sect4">
<h5 id="_functional_test_results_3"><a class="anchor" href="#_functional_test_results_3"></a>8.1.3.1. Functional test results</h5>

</div>
<div class="sect4">
<h5 id="_performance_test_results_3"><a class="anchor" href="#_performance_test_results_3"></a>8.1.3.2. Performance test results</h5>

</div>
<div class="sect4">
<h5 id="_testing_observations_3"><a class="anchor" href="#_testing_observations_3"></a>8.1.3.3. Testing observations</h5>

</div>
</div>
<div class="sect3">
<h4 id="global-cache-korea-results"><a class="anchor" href="#global-cache-korea-results"></a>8.1.4. Republic of Korea</h4>
<div class="sect4">
<h5 id="_functional_test_results_4"><a class="anchor" href="#_functional_test_results_4"></a>8.1.4.1. Functional test results</h5>

</div>
<div class="sect4">
<h5 id="_performance_test_results_4"><a class="anchor" href="#_performance_test_results_4"></a>8.1.4.2. Performance test results</h5>

</div>
<div class="sect4">
<h5 id="_testing_observations_4"><a class="anchor" href="#_testing_observations_4"></a>8.1.4.3. Testing observations</h5>

</div>
</div>
<div class="sect3">
<h4 id="global-cache-uk-us-results"><a class="anchor" href="#global-cache-uk-us-results"></a>8.1.5. United Kingdom of Great Britain and Northern Ireland / United States of America</h4>
<div class="sect4">
<h5 id="_functional_test_results_5"><a class="anchor" href="#_functional_test_results_5"></a>8.1.5.1. Functional test results</h5>

</div>
<div class="sect4">
<h5 id="_performance_test_results_5"><a class="anchor" href="#_performance_test_results_5"></a>8.1.5.2. Performance test results</h5>

</div>
<div class="sect4">
<h5 id="_testing_observations_5"><a class="anchor" href="#_testing_observations_5"></a>8.1.5.3. Testing observations</h5>

</div>
</div>
</div>
<div class="sect2">
<h3 id="global-broker-results"><a class="anchor" href="#global-broker-results"></a>8.2. Global Broker Service results</h3>
<div class="sect3">
<h4 id="global-broker-brazil-results"><a class="anchor" href="#global-broker-brazil-results"></a>8.2.1. Brazil</h4>
<div class="sect4">
<h5 id="_functional_test_results_6"><a class="anchor" href="#_functional_test_results_6"></a>8.2.1.1. Functional test results</h5>

</div>
<div class="sect4">
<h5 id="_performance_test_results_6"><a class="anchor" href="#_performance_test_results_6"></a>8.2.1.2. Performance test results</h5>

</div>
<div class="sect4">
<h5 id="_testing_observations_6"><a class="anchor" href="#_testing_observations_6"></a>8.2.1.3. Testing observations</h5>

</div>
</div>
<div class="sect3">
<h4 id="global-broker-china-results"><a class="anchor" href="#global-broker-china-results"></a>8.2.2. China</h4>
<div class="sect4">
<h5 id="_functional_test_results_7"><a class="anchor" href="#_functional_test_results_7"></a>8.2.2.1. Functional test results</h5>

</div>
<div class="sect4">
<h5 id="_performance_test_results_7"><a class="anchor" href="#_performance_test_results_7"></a>8.2.2.2. Performance test results</h5>

</div>
<div class="sect4">
<h5 id="_testing_observations_7"><a class="anchor" href="#_testing_observations_7"></a>8.2.2.3. Testing observations</h5>

</div>
</div>
<div class="sect3">
<h4 id="global-broker-france-results"><a class="anchor" href="#global-broker-france-results"></a>8.2.3. France</h4>
<div class="sect4">
<h5 id="_functional_test_results_8"><a class="anchor" href="#_functional_test_results_8"></a>8.2.3.1. Functional test results</h5>

</div>
<div class="sect4">
<h5 id="_performance_test_results_8"><a class="anchor" href="#_performance_test_results_8"></a>8.2.3.2. Performance test results</h5>

</div>
<div class="sect4">
<h5 id="_testing_observations_8"><a class="anchor" href="#_testing_observations_8"></a>8.2.3.3. Testing observations</h5>

</div>
</div>
<div class="sect3">
<h4 id="global-broker-usa-results"><a class="anchor" href="#global-broker-usa-results"></a>8.2.4. United States of America</h4>
<div class="sect4">
<h5 id="_functional_test_results_9"><a class="anchor" href="#_functional_test_results_9"></a>8.2.4.1. Functional test results</h5>

</div>
<div class="sect4">
<h5 id="_performance_test_results_9"><a class="anchor" href="#_performance_test_results_9"></a>8.2.4.2. Performance test results</h5>

</div>
<div class="sect4">
<h5 id="_testing_observations_9"><a class="anchor" href="#_testing_observations_9"></a>8.2.4.3. Testing observations</h5>

</div>
</div>
</div>
<div class="sect2">
<h3 id="global-discovery-catalogue-results"><a class="anchor" href="#global-discovery-catalogue-results"></a>8.3. Global Discovery Catalogue results</h3>
<div class="sect3">
<h4 id="global-discovery-catalogue-canada-results"><a class="anchor" href="#global-discovery-catalogue-canada-results"></a>8.3.1. Canada</h4>
<div class="sect4">
<h5 id="_functional_test_results_10"><a class="anchor" href="#_functional_test_results_10"></a>8.3.1.1. Functional test results</h5>

</div>
<div class="sect4">
<h5 id="_performance_test_results_10"><a class="anchor" href="#_performance_test_results_10"></a>8.3.1.2. Performance test results</h5>

</div>
<div class="sect4">
<h5 id="_testing_observations_10"><a class="anchor" href="#_testing_observations_10"></a>8.3.1.3. Testing observations</h5>

</div>
</div>
<div class="sect3">
<h4 id="global-discovery-catalogue-china-results"><a class="anchor" href="#global-discovery-catalogue-china-results"></a>8.3.2. China</h4>
<div class="sect4">
<h5 id="_functional_test_results_11"><a class="anchor" href="#_functional_test_results_11"></a>8.3.2.1. Functional test results</h5>

</div>
<div class="sect4">
<h5 id="_performance_test_results_11"><a class="anchor" href="#_performance_test_results_11"></a>8.3.2.2. Performance test results</h5>

</div>
<div class="sect4">
<h5 id="_testing_observations_11"><a class="anchor" href="#_testing_observations_11"></a>8.3.2.3. Testing observations</h5>

</div>
</div>
</div>
<div class="sect2">
<h3 id="global-monitor-results"><a class="anchor" href="#global-monitor-results"></a>8.4. Global Monitor results</h3>
<div class="sect3">
<h4 id="global-monitor-china-results"><a class="anchor" href="#global-monitor-china-results"></a>8.4.1. China</h4>
<div class="sect4">
<h5 id="_functional_test_results_12"><a class="anchor" href="#_functional_test_results_12"></a>8.4.1.1. Functional test results</h5>

</div>
<div class="sect4">
<h5 id="_performance_test_results_12"><a class="anchor" href="#_performance_test_results_12"></a>8.4.1.2. Performance test results</h5>

</div>
<div class="sect4">
<h5 id="_testing_observations_12"><a class="anchor" href="#_testing_observations_12"></a>8.4.1.3. Testing observations</h5>

</div>
</div>
<div class="sect3">
<h4 id="global-monitor-morocco-results"><a class="anchor" href="#global-monitor-morocco-results"></a>8.4.2. Morocco</h4>
<div class="sect4">
<h5 id="_functional_test_results_13"><a class="anchor" href="#_functional_test_results_13"></a>8.4.2.1. Functional test results</h5>

</div>
<div class="sect4">
<h5 id="_performance_test_results_13"><a class="anchor" href="#_performance_test_results_13"></a>8.4.2.2. Performance test results</h5>

</div>
<div class="sect4">
<h5 id="_testing_observations_13"><a class="anchor" href="#_testing_observations_13"></a>8.4.2.3. Testing observations</h5>

</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="discussion"><a class="anchor" href="#discussion"></a>9. Discussion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>TODO</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="conclusions"><a class="anchor" href="#conclusions"></a>10. Conclusions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>TODO</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_future_work"><a class="anchor" href="#_future_work"></a>11. Future work</h2>
<div class="sectionbody">
<div class="paragraph">
<p>TODO</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_revision_history"><a class="anchor" href="#_revision_history"></a>Appendix A: Revision History</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all" style="width: 90%;">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color: #FFFFFF;">Date</th>
<th class="tableblock halign-left valign-top" style="background-color: #FFFFFF;">Release</th>
<th class="tableblock halign-left valign-top" style="background-color: #FFFFFF;">Author</th>
<th class="tableblock halign-left valign-top" style="background-color: #FFFFFF;">Primary clauses modified</th>
<th class="tableblock halign-left valign-top" style="background-color: #FFFFFF;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #FFFFFF;"><p class="tableblock">2024-03-30</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #FFFFFF;"><p class="tableblock">0.1</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #FFFFFF;"><p class="tableblock">Kralidis</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #FFFFFF;"><p class="tableblock">all</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #FFFFFF;"><p class="tableblock">initial version</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="annex-bibliography"><a class="anchor" href="#annex-bibliography"></a>Bibliography</h2>
<div class="sectionbody">
<div class="ulist bibliography">
<ul class="bibliography">
<li>
<p><a id="ab"></a> ab - Apache HTTP server benchmarking tool (2024) <sup class="footnote">[<a id="_footnoteref_8" class="footnote" href="#_footnotedef_8" title="View footnote.">8</a>]</sup></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. <a href="https://community.wmo.int/governance/commission-membership/commission-observation-infrastructures-and-information-systems-infcom/commission-infrastructure-officers/infcom-management-group/standing-committee-information-management-and-technology-sc-imt" class="bare">https://community.wmo.int/governance/commission-membership/commission-observation-infrastructures-and-information-systems-infcom/commission-infrastructure-officers/infcom-management-group/standing-committee-information-management-and-technology-sc-imt</a>
</div>
<div class="footnote" id="_footnotedef_2">
<a href="#_footnoteref_2">2</a>. <a href="https://community.wmo.int/governance/commission-membership/infcom" class="bare">https://community.wmo.int/governance/commission-membership/infcom</a>
</div>
<div class="footnote" id="_footnotedef_3">
<a href="#_footnoteref_3">3</a>. <a href="https://wmo-im.github.io/wcmp2" class="bare">https://wmo-im.github.io/wcmp2</a>
</div>
<div class="footnote" id="_footnotedef_4">
<a href="#_footnoteref_4">4</a>. <a href="https://wmo-im.github.io/wis2-notification-message" class="bare">https://wmo-im.github.io/wis2-notification-message</a>
</div>
<div class="footnote" id="_footnotedef_5">
<a href="#_footnoteref_5">5</a>. <a href="https://wmo-im.github.io/wis2-topic-hierarchy" class="bare">https://wmo-im.github.io/wis2-topic-hierarchy</a>
</div>
<div class="footnote" id="_footnotedef_6">
<a href="#_footnoteref_6">6</a>. <a href="https://wmo-im.github.io/wis2-guide/guide/wis2-guide-DRAFT.html" class="bare">https://wmo-im.github.io/wis2-guide/guide/wis2-guide-DRAFT.html</a>
</div>
<div class="footnote" id="_footnotedef_7">
<a href="#_footnoteref_7">7</a>. <a href="https://wmo-im.github.io/wis2-transition-guide/transition-guide/wis2-transition-guide-DRAFT.html" class="bare">https://wmo-im.github.io/wis2-transition-guide/transition-guide/wis2-transition-guide-DRAFT.html</a>
</div>
<div class="footnote" id="_footnotedef_8">
<a href="#_footnoteref_8">8</a>. <a href="https://httpd.apache.org/docs/2.4/programs/ab.html" class="bare">https://httpd.apache.org/docs/2.4/programs/ab.html</a>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2024-08-13 12:54:27 UTC
</div>
</div>
</body>
</html>